(this.webpackJsonp=this.webpackJsonp||[]).push([[0],{117:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var lng_lat_1=__webpack_require__(255);function circumferenceAtLatitude(latitude){return 2*Math.PI*6378137*Math.cos(latitude*Math.PI/180)}function mercatorXfromLng(lng){return(180+lng)/360}function mercatorYfromLat(lat){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+lat*Math.PI/360)))/360}function mercatorZfromAltitude(altitude,lat){return altitude/circumferenceAtLatitude(lat)}function lngFromMercatorX(x){return 360*x-180}function latFromMercatorY(y){var y2=180-360*y;return 360/Math.PI*Math.atan(Math.exp(y2*Math.PI/180))-90}function altitudeFromMercatorZ(z,y){return z*circumferenceAtLatitude(latFromMercatorY(y))}exports.mercatorXfromLng=mercatorXfromLng,exports.mercatorYfromLat=mercatorYfromLat,exports.mercatorZfromAltitude=mercatorZfromAltitude,exports.lngFromMercatorX=lngFromMercatorX,exports.latFromMercatorY=latFromMercatorY,exports.altitudeFromMercatorZ=altitudeFromMercatorZ;var MercatorCoordinate=function(){function MercatorCoordinate(x,y,z){void 0===z&&(z=0),this.x=+x,this.y=+y,this.z=+z}return MercatorCoordinate.fromLngLat=function(lngLatLike,altitude){void 0===altitude&&(altitude=0);var lngLat=lng_lat_1.default.convert(lngLatLike);return new MercatorCoordinate(mercatorXfromLng(lngLat.lng),mercatorYfromLat(lngLat.lat),mercatorZfromAltitude(altitude,lngLat.lat))},MercatorCoordinate.prototype.toLngLat=function(){return new lng_lat_1.default(lngFromMercatorX(this.x),latFromMercatorY(this.y))},MercatorCoordinate.prototype.toAltitude=function(){return altitudeFromMercatorZ(this.z,this.y)},MercatorCoordinate}();exports.default=MercatorCoordinate},162:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Point=__webpack_require__(116),tile_id_1=__webpack_require__(68);function edge(a,b){if(a.y>b.y){var t=a;a=b,b=t}return{x0:a.x,y0:a.y,x1:b.x,y1:b.y,dx:b.x-a.x,dy:b.y-a.y}}function scanSpans(e0,e1,ymin,ymax,scanLine){var y0=Math.max(ymin,Math.floor(e1.y0)),y1=Math.min(ymax,Math.ceil(e1.y1));if(e0.x0===e1.x0&&e0.y0===e1.y0?e0.x0+e1.dy/e0.dy*e0.dx<e1.x1:e0.x1-e1.dy/e0.dy*e0.dx<e1.x0){var t=e0;e0=e1,e1=t}for(var m0=e0.dx/e0.dy,m1=e1.dx/e1.dy,d0=e0.dx>0?1:0,d1=e1.dx<0?1:0,y=y0;y<y1;y++){var x0=m0*Math.max(0,Math.min(e0.dy,y+d0-e0.y0))+e0.x0,x1=m1*Math.max(0,Math.min(e1.dy,y+d1-e1.y0))+e1.x0;scanLine(Math.floor(x1),Math.ceil(x0),y)}}function scanTriangle(a,b,c,ymin,ymax,scanLine){var t,ab=edge(a,b),bc=edge(b,c),ca=edge(c,a);ab.dy>bc.dy&&(t=ab,ab=bc,bc=t),ab.dy>ca.dy&&(t=ab,ab=ca,ca=t),bc.dy>ca.dy&&(t=bc,bc=ca,ca=t),ab.dy&&scanSpans(ca,ab,ymin,ymax,scanLine),bc.dy&&scanSpans(ca,bc,ymin,ymax,scanLine)}exports.default=function tileCover(z,bounds,actualZ,renderWorldCopies){void 0===renderWorldCopies&&(renderWorldCopies=!0);var tiles=1<<z,t={};function scanLine(x0,x1,y){var x,w,wx,coord;if(y>=0&&y<=tiles)for(x=x0;x<x1;x++)w=Math.floor(x/tiles),wx=(x%tiles+tiles)%tiles,0!==w&&!0!==renderWorldCopies||(coord=new tile_id_1.OverscaledTileID(actualZ,w,z,wx,y),t[coord.key]=coord)}var zoomedBounds=bounds.map(function(coord){return new Point(coord.x,coord.y)._mult(tiles)});return scanTriangle(zoomedBounds[0],zoomedBounds[1],zoomedBounds[2],0,tiles,scanLine),scanTriangle(zoomedBounds[2],zoomedBounds[3],zoomedBounds[0],0,tiles,scanLine),Object.keys(t).map(function(id){return t[id]})}},163:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var gl_matrix_1=__webpack_require__(681),tile_id_1=__webpack_require__(68);exports.tileSize=512,exports.pixelsToTileUnits=function pixelsToTileUnits(overscaledZ,pixelValue,z){return pixelValue*(tile_id_1.EXTENT/(exports.tileSize*Math.pow(2,z-overscaledZ)))},exports.getLabelPlaneMatrix=function getLabelPlaneMatrix(posMatrix,pitchWithMap,rotateWithMap,transform,pixelsToTileUnits){var m=gl_matrix_1.mat4.identity(new Float32Array(16));return pitchWithMap?(gl_matrix_1.mat4.identity(m),gl_matrix_1.mat4.scale(m,m,[1/pixelsToTileUnits,1/pixelsToTileUnits,1]),rotateWithMap||gl_matrix_1.mat4.rotateZ(m,m,transform.angle)):(gl_matrix_1.mat4.scale(m,m,[transform.width/2,-transform.height/2,1]),gl_matrix_1.mat4.translate(m,m,[1,-1,0]),gl_matrix_1.mat4.multiply(m,m,posMatrix)),m},exports.getGlCoordMatrix=function getGlCoordMatrix(posMatrix,pitchWithMap,rotateWithMap,transform,pixelsToTileUnits){var m=gl_matrix_1.mat4.identity(new Float32Array(16));return pitchWithMap?(gl_matrix_1.mat4.multiply(m,m,posMatrix),gl_matrix_1.mat4.scale(m,m,[pixelsToTileUnits,pixelsToTileUnits,1]),rotateWithMap||gl_matrix_1.mat4.rotateZ(m,m,-transform.angle)):(gl_matrix_1.mat4.scale(m,m,[1,-1,1]),gl_matrix_1.mat4.translate(m,m,[-1,-1,0]),gl_matrix_1.mat4.scale(m,m,[2/transform.width,2/transform.height,1])),m},exports.xyTransformMat4=function xyTransformMat4(out,a,m){var x=a[0],y=a[1];return out[0]=m[0]*x+m[4]*y+m[12],out[1]=m[1]*x+m[5]*y+m[13],out[3]=m[3]*x+m[7]*y+m[15],out}},164:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.sdf2DFunctions=["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],exports.getShapeIndex=function getShapeIndex(shape){return exports.sdf2DFunctions.indexOf(shape)}},255:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var lng_lat_bounds_1=__webpack_require__(594);var LngLat=function(){function LngLat(lng,lat){if(isNaN(lng)||isNaN(lat))throw new Error("Invalid LngLat object: ("+lng+", "+lat+")");if(this.lng=+lng,this.lat=+lat,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}return LngLat.prototype.wrap=function(){return new LngLat(function wrap(n,min,max){var d=max-min,w=((n-min)%d+d)%d+min;return w===min?max:w}(this.lng,-180,180),this.lat)},LngLat.prototype.toArray=function(){return[this.lng,this.lat]},LngLat.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},LngLat.prototype.toBounds=function(radius){void 0===radius&&(radius=0);var latAccuracy=360*radius/40075017,lngAccuracy=latAccuracy/Math.cos(Math.PI/180*this.lat);return new lng_lat_bounds_1.default(new LngLat(this.lng-lngAccuracy,this.lat-latAccuracy),new LngLat(this.lng+lngAccuracy,this.lat+latAccuracy))},LngLat.convert=function(input){if(input instanceof LngLat)return input;if(Array.isArray(input)&&(2===input.length||3===input.length))return new LngLat(Number(input[0]),Number(input[1]));if(!Array.isArray(input)&&"object"==typeof input&&null!==input)return new LngLat(Number("lng"in input?input.lng:input.lon),Number(input.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")},LngLat}();exports.default=LngLat},256:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var TinySDF=__webpack_require__(599),AlphaImage_1=__webpack_require__(257),fontsize=24,buffer=3,radius=8,cutoff=.25,sdfGeneratorCache={},textMetricsCache={};function isCJK(char){return char>=19968&&char<=40959}exports.isCJK=isCJK,exports.getDefaultCharacterSet=function getDefaultCharacterSet(){for(var charSet=[],i=32;i<128;i++)charSet.push(String.fromCharCode(i));return charSet},exports.generateSDF=function generateSDF(fontStack,char){void 0===fontStack&&(fontStack="");var _a=function extractFontStack(fontStack){var fontFamily=fontStack.trim().substring(0,fontStack.lastIndexOf(" ")),fontWeight="400";return/bold/i.test(fontStack)?fontWeight="900":/medium/i.test(fontStack)?fontWeight="500":/light/i.test(fontStack)&&(fontWeight="200"),{fontFamily:fontFamily,fontWeight:fontWeight}}(fontStack),fontFamily=_a.fontFamily,fontWeight=_a.fontWeight,charCode=char.charCodeAt(0),sdfGenerator=sdfGeneratorCache[fontStack];return sdfGenerator||(sdfGenerator=sdfGeneratorCache[fontStack]=new TinySDF(fontsize,buffer,radius,cutoff,fontFamily,fontWeight)),textMetricsCache[fontStack]||(textMetricsCache[fontStack]={}),textMetricsCache[fontStack][char]||(textMetricsCache[fontStack][char]=sdfGenerator.ctx.measureText(char).width),{id:charCode,bitmap:new AlphaImage_1.AlphaImage({width:30,height:30},sdfGenerator.draw(char)),metrics:{width:24,height:24,left:0,top:-5,advance:isCJK(charCode)?24:textMetricsCache[fontStack][char]}}}},257:function(module,exports,__webpack_require__){"use strict";function createImage(image,_a,channels,data){var width=_a.width,height=_a.height;if(data){if(data.length!==width*height*channels)throw new RangeError("mismatched image size")}else data=new Uint8Array(width*height*channels);return image.width=width,image.height=height,image.data=data,image}function copyImage(srcImg,dstImg,srcPt,dstPt,size,channels){if(0===size.width||0===size.height)return dstImg;if(size.width>srcImg.width||size.height>srcImg.height||srcPt.x>srcImg.width-size.width||srcPt.y>srcImg.height-size.height)throw new RangeError("out of range source coordinates for image copy");if(size.width>dstImg.width||size.height>dstImg.height||dstPt.x>dstImg.width-size.width||dstPt.y>dstImg.height-size.height)throw new RangeError("out of range destination coordinates for image copy");for(var srcData=srcImg.data,dstData=dstImg.data,y=0;y<size.height;y++)for(var srcOffset=((srcPt.y+y)*srcImg.width+srcPt.x)*channels,dstOffset=((dstPt.y+y)*dstImg.width+dstPt.x)*channels,i=0;i<size.width*channels;i++)dstData[dstOffset+i]=srcData[srcOffset+i];return dstImg}Object.defineProperty(exports,"__esModule",{value:!0});var AlphaImage=function(){function AlphaImage(size,data){createImage(this,size,1,data)}return AlphaImage.prototype.resize=function(size){!function resizeImage(image,_a,channels){var width=_a.width,height=_a.height;if(width!==image.width||height!==image.height){var newImage=createImage({},{width:width,height:height},channels);copyImage(image,newImage,{x:0,y:0},{x:0,y:0},{width:Math.min(image.width,width),height:Math.min(image.height,height)},channels),image.width=width,image.height=height,image.data=newImage.data}}(this,size,1)},AlphaImage.prototype.clone=function(){return new AlphaImage({width:this.width,height:this.height},new Uint8Array(this.data))},AlphaImage.copy=function(srcImg,dstImg,srcPt,dstPt,size){copyImage(srcImg,dstImg,srcPt,dstPt,size,1)},AlphaImage}();exports.AlphaImage=AlphaImage},258:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.shapeText=function shapeText(text,glyphs,defaultFontStack,maxWidth,lineHeight,textAnchor,textJustify,spacing,translate,writingMode){var lines=text.split("\n"),positionedGlyphs=[],shaping={positionedGlyphs:positionedGlyphs,text:text,top:translate[1],bottom:translate[1],left:translate[0],right:translate[0],writingMode:writingMode,lineCount:lines.length};return function shapeLines(shaping,glyphMap,lines,lineHeight,textAnchor,textJustify,writingMode,spacing,fontStack){var x=0,y=-17,maxLineLength=0,positionedGlyphs=shaping.positionedGlyphs,justify="right"===textJustify?1:"left"===textJustify?0:.5,lineStartIndex=positionedGlyphs.length;lines.forEach(function(line){if(line.split("").forEach(function(char){var positions=glyphMap[fontStack],charCode=char.charCodeAt(0),glyph=positions&&positions[charCode];glyph&&(positionedGlyphs.push({glyph:charCode,x:x,y:y+0,vertical:!1,scale:1,fontStack:fontStack}),x+=glyph.metrics.advance+spacing)}),positionedGlyphs.length!==lineStartIndex){var lineLength=x-spacing;maxLineLength=Math.max(lineLength,maxLineLength),function justifyLine(positionedGlyphs,glyphMap,start,end,justify){if(justify){var lastPositionedGlyph=positionedGlyphs[end],positions=glyphMap[lastPositionedGlyph.fontStack],glyph=positions&&positions[lastPositionedGlyph.glyph];if(glyph)for(var lastAdvance=glyph.metrics.advance*lastPositionedGlyph.scale,lineIndent=(positionedGlyphs[end].x+lastAdvance)*justify,j=start;j<=end;j++)positionedGlyphs[j].x-=lineIndent}}(positionedGlyphs,glyphMap,lineStartIndex,positionedGlyphs.length-1,justify)}x=0,y+=lineHeight});var _a=function getAnchorAlignment(anchor){var horizontalAlign=.5,verticalAlign=.5;switch(anchor){case"right":case"top-right":case"bottom-right":horizontalAlign=1;break;case"left":case"top-left":case"bottom-left":horizontalAlign=0}switch(anchor){case"bottom":case"bottom-right":case"bottom-left":verticalAlign=1;break;case"top":case"top-right":case"top-left":verticalAlign=0}return{horizontalAlign:horizontalAlign,verticalAlign:verticalAlign}}(textAnchor),horizontalAlign=_a.horizontalAlign,verticalAlign=_a.verticalAlign;!function align(positionedGlyphs,justify,horizontalAlign,verticalAlign,maxLineLength,lineHeight,lineCount){for(var shiftX=(justify-horizontalAlign)*maxLineLength,shiftY=(-verticalAlign*lineCount+.5)*lineHeight,j=0;j<positionedGlyphs.length;j++)positionedGlyphs[j].x+=shiftX,positionedGlyphs[j].y+=shiftY}(positionedGlyphs,justify,horizontalAlign,verticalAlign,maxLineLength,lineHeight,lines.length);var height=y- -17;shaping.top+=-verticalAlign*height,shaping.bottom=shaping.top+height,shaping.left+=-horizontalAlign*maxLineLength,shaping.right=shaping.left+maxLineLength}(shaping,glyphs,lines,lineHeight,textAnchor,textJustify,0,spacing,defaultFontStack),!!positionedGlyphs.length&&shaping}},259:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var AlphaImage_1=__webpack_require__(257),potpack_1=__webpack_require__(600),padding=1,GlyphAtlas=function(){return function GlyphAtlas(stacks){var positions={},bins=[];for(var stack in stacks){var glyphs=stacks[stack],stackPositions=positions[stack]={};for(var id in glyphs)if((src=glyphs[+id])&&0!==src.bitmap.width&&0!==src.bitmap.height){var bin={x:0,y:0,w:src.bitmap.width+2*padding,h:src.bitmap.height+2*padding};bins.push(bin),stackPositions[id]={rect:bin,metrics:src.metrics}}}var _a=potpack_1.default(bins),w=_a.w,h=_a.h,image=new AlphaImage_1.AlphaImage({width:w||1,height:h||1});for(var stack in stacks)for(var id in glyphs=stacks[stack]){var src;(src=glyphs[+id])&&0!==src.bitmap.width&&0!==src.bitmap.height&&(bin=positions[stack][id].rect,AlphaImage_1.AlphaImage.copy(src.bitmap,image,{x:0,y:0},{x:bin.x+padding,y:bin.y+padding},src.bitmap))}this.image=image,this.positions=positions}}();exports.default=GlyphAtlas},260:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Point=__webpack_require__(116),GLYPH_PBF_BORDER=3;exports.getGlyphQuads=function getGlyphQuads(shaping,textOffset,alongLine,positions){for(var positionedGlyphs=shaping.positionedGlyphs,quads=[],k=0;k<positionedGlyphs.length;k++){var positionedGlyph=positionedGlyphs[k],glyphPositions=positions[positionedGlyph.fontStack],glyph=glyphPositions&&glyphPositions[positionedGlyph.glyph];if(glyph){var rect=glyph.rect;if(rect){var rectBuffer=GLYPH_PBF_BORDER+1,halfAdvance=glyph.metrics.advance*positionedGlyph.scale/2,glyphOffset=alongLine?[positionedGlyph.x+halfAdvance,positionedGlyph.y]:[0,0],builtInOffset=alongLine?[0,0]:[positionedGlyph.x+halfAdvance+textOffset[0],positionedGlyph.y+textOffset[1]],x1=(glyph.metrics.left-rectBuffer)*positionedGlyph.scale-halfAdvance+builtInOffset[0],y1=(-glyph.metrics.top-rectBuffer)*positionedGlyph.scale+builtInOffset[1],x2=x1+rect.w*positionedGlyph.scale,y2=y1+rect.h*positionedGlyph.scale,tl=new Point(x1,y1),tr=new Point(x2,y1),bl=new Point(x1,y2),br=new Point(x2,y2);quads.push({tl:tl,tr:tr,bl:bl,br:br,tex:rect,writingMode:shaping.writingMode,glyphOffset:glyphOffset})}}}return quads}},261:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var lodash_1=__webpack_require__(601),sdf_2d_1=__webpack_require__(164),LEFT_SHIFT1=2,LEFT_SHIFT6=64,LEFT_SHIFT8=256,LEFT_SHIFT9=512,LEFT_SHIFT16=65536,LEFT_SHIFT17=131072,LEFT_SHIFT19=524288,LEFT_SHIFT21=2097152,LEFT_SHIFT23=8388608,LEFT_SHIFT24=16777216,LEFT_SHIFT25=33554432;function packUint8ToFloat(a,b){return 256*(a=lodash_1.clamp(Math.floor(a),0,255))+(b=lodash_1.clamp(Math.floor(b),0,255))}exports.packUint8ToFloat=packUint8ToFloat,exports.packCircleVertex=function packCircleVertex(props){var color=props.color,radius=props.radius,tileX=props.tileX,tileY=props.tileY,shape=props.shape,opacity=props.opacity,strokeColor=props.strokeColor,strokeWidth=props.strokeWidth,strokeOpacity=props.strokeOpacity,packedBuffer=[],packedBuffer2=[],packedBuffer3=[],packedColor=[packUint8ToFloat(color[0],color[1]),packUint8ToFloat(color[2],color[3])],packedStrokeColor=[packUint8ToFloat(strokeColor[0],strokeColor[1]),packUint8ToFloat(strokeColor[2],strokeColor[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(extrude){packedBuffer.push(packedColor.concat([(extrude[0]+1)*LEFT_SHIFT23+(extrude[1]+1)*LEFT_SHIFT21+sdf_2d_1.getShapeIndex(shape)*LEFT_SHIFT17+radius,(tileX+512)*LEFT_SHIFT19+(tileY+512)*LEFT_SHIFT6])),packedBuffer2.push(packedStrokeColor.concat([strokeWidth,strokeOpacity])),packedBuffer3.push([opacity,0,0,0])}),{packedBuffer:packedBuffer,packedBuffer2:packedBuffer2,packedBuffer3:packedBuffer3}},exports.packOpacity=function packOpacity(opacity,placed){if(0===opacity&&!placed)return 0;if(1===opacity&&placed)return 4294967295;var targetBit=placed?1:0,opacityBits=Math.floor(127*opacity);return opacityBits*LEFT_SHIFT25+targetBit*LEFT_SHIFT24+opacityBits*LEFT_SHIFT17+targetBit*LEFT_SHIFT16+opacityBits*LEFT_SHIFT9+targetBit*LEFT_SHIFT8+opacityBits*LEFT_SHIFT1+targetBit}},262:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var GridIndex_1=__webpack_require__(602),Point=__webpack_require__(116),symbol_projection_1=__webpack_require__(163),viewportPadding=100,CollisionIndex=function(){function CollisionIndex(transform,grid){void 0===grid&&(grid=new GridIndex_1.default(transform.width+2*viewportPadding,transform.height+2*viewportPadding,25)),this.transform=transform,this.grid=grid,this.screenRightBoundary=transform.width+viewportPadding,this.screenBottomBoundary=transform.height+viewportPadding,this.gridRightBoundary=transform.width+2*viewportPadding,this.gridBottomBoundary=transform.height+2*viewportPadding}return CollisionIndex.prototype.placeCollisionBox=function(collisionBox,allowOverlap,textPixelRatio,posMatrix,collisionGroupPredicate){var projectedPoint=this.projectAndGetPerspectiveRatio(posMatrix,collisionBox.anchorPointX,collisionBox.anchorPointY),tlX=collisionBox.x1+projectedPoint.point.x,tlY=collisionBox.y1+projectedPoint.point.y,brX=collisionBox.x2+projectedPoint.point.x,brY=collisionBox.y2+projectedPoint.point.y;return!this.isInsideGrid(tlX,tlY,brX,brY)||!allowOverlap&&this.grid.hitTest(tlX,tlY,brX,brY,collisionGroupPredicate)?{box:[],offscreen:!1}:{box:[tlX,tlY,brX,brY],offscreen:this.isOffscreen(tlX,tlY,brX,brY)}},CollisionIndex.prototype.insertCollisionBox=function(collisionBox,bucketInstanceId,featureIndex,collisionGroupID){var key={bucketInstanceId:bucketInstanceId,featureIndex:featureIndex,collisionGroupID:collisionGroupID};this.grid.insert(key,collisionBox[0],collisionBox[1],collisionBox[2],collisionBox[3])},CollisionIndex.prototype.projectAndGetPerspectiveRatio=function(posMatrix,x,y){var p=[x,y,0,1];return symbol_projection_1.xyTransformMat4(p,p,posMatrix),{point:new Point((p[0]/p[3]+1)/2*this.transform.width+viewportPadding,(-p[1]/p[3]+1)/2*this.transform.height+viewportPadding),perspectiveRatio:.5+this.transform.cameraToCenterDistance/p[3]*.5}},CollisionIndex.prototype.isOffscreen=function(x1,y1,x2,y2){return x2<viewportPadding||x1>=this.screenRightBoundary||y2<viewportPadding||y1>this.screenBottomBoundary},CollisionIndex.prototype.isInsideGrid=function(x1,y1,x2,y2){return x2>=0&&x1<this.gridRightBoundary&&y2>=0&&y1<this.gridBottomBoundary},CollisionIndex}();exports.default=CollisionIndex},263:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var polyline_miter_util_1=__webpack_require__(604),gl_vec2_1=__webpack_require__(605);function extrusions(positions,out,point,normal,scale){addNext(out,normal,-scale),addNext(out,normal,scale),positions.push(point),positions.push(point)}function addNext(out,normal,length){out.push([[normal[0],normal[1]],length])}exports.default=function default_1(points,closed,indexOffset){var lineA=[0,0],lineB=[0,0],tangent=[0,0],miter=[0,0],_lastFlip=-1,_started=!1,_normal=null,tmp=gl_vec2_1.create(),count=indexOffset||0,out=[],attrPos=[],attrIndex=[],attrCounters=[0,0];closed&&(points=points.slice()).push(points[0]);for(var total=points.length,i=1;i<total;i++){var index=count,last=points[i-1],cur=points[i],next=i<points.length-1?points[i+1]:null;if(attrCounters.push(i/total,i/total),polyline_miter_util_1.direction(lineA,cur,last),_normal||(_normal=[0,0],polyline_miter_util_1.normal(_normal,lineA)),_started||(_started=!0,extrusions(attrPos,out,last,_normal,1)),attrIndex.push([index+0,index+1,index+2]),next){polyline_miter_util_1.direction(lineB,next,cur);var miterLen=polyline_miter_util_1.computeMiter(tangent,miter,lineA,lineB,1),flip=gl_vec2_1.dot(tangent,_normal)<0?-1:1,bevel=miterLen>3;if(!isFinite(miterLen)){polyline_miter_util_1.normal(_normal,lineA),extrusions(attrPos,out,cur,_normal,1),attrIndex.push(1===_lastFlip?[index,index+2,index+3]:[index+2,index+1,index+3]),count+=2,_lastFlip=flip;continue}bevel?(miterLen=3,attrCounters.push(i/total),addNext(out,_normal,-flip),attrPos.push(cur),addNext(out,miter,miterLen*flip),attrPos.push(cur),attrIndex.push(_lastFlip!==-flip?[index,index+2,index+3]:[index+2,index+1,index+3]),attrIndex.push([index+2,index+3,index+4]),polyline_miter_util_1.normal(tmp,lineB),gl_vec2_1.copy(_normal,tmp),addNext(out,_normal,-flip),attrPos.push(cur),count+=3):(extrusions(attrPos,out,cur,miter,miterLen),attrIndex.push(1===_lastFlip?[index,index+2,index+3]:[index+2,index+1,index+3]),flip=-1,gl_vec2_1.copy(_normal,miter),count+=2),_lastFlip=flip}else polyline_miter_util_1.normal(_normal,lineA),extrusions(attrPos,out,cur,_normal,1),attrIndex.push(1===_lastFlip?[index,index+2,index+3]:[index+2,index+1,index+3]),count+=2}return{normals:out,attrIndex:attrIndex,attrPos:attrPos,attrCounters:attrCounters}}},281:function(module,exports,__webpack_require__){__webpack_require__(282),__webpack_require__(385),module.exports=__webpack_require__(386)},31:function(module,exports,__webpack_require__){"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)};Object.defineProperty(exports,"__esModule",{value:!0});var _regl=__webpack_require__(587),Stats=__webpack_require__(588),MapboxAdapterLayer=function(){function MapboxAdapterLayer(){this.type="custom"}return MapboxAdapterLayer.prototype.initStats=function(){this.stats=new Stats,this.stats.showPanel(0);var $stats=this.stats.dom;$stats.style.position="absolute",$stats.style.left="0px",$stats.style.top="0px",document.body.appendChild($stats)},MapboxAdapterLayer.prototype.triggerRepaint=function(){this.map.triggerRepaint()},MapboxAdapterLayer.prototype.onAdd=function(map,gl){this.map=map,this.regl=_regl(__assign({},this.getReglInitializationOptions(),{gl:gl})),this.init(map,gl),this.initStats()},MapboxAdapterLayer.prototype.render=function(gl,matrix){this.stats||this.initStats(),this.stats&&this.stats.update(),this.frame(gl,matrix)},MapboxAdapterLayer.prototype.prerender=function(gl,matrix){this.beforeRender&&this.beforeRender(gl,matrix)},MapboxAdapterLayer}();exports.default=MapboxAdapterLayer},38:function(module,exports,__webpack_require__){"use strict";var SHADER_TYPE;Object.defineProperty(exports,"__esModule",{value:!0}),function(SHADER_TYPE){SHADER_TYPE.VS="vs",SHADER_TYPE.FS="fs"}(SHADER_TYPE||(SHADER_TYPE={}));var moduleCache={},rawContentCache={},precisionRegExp=/precision\s+(high|low|medium)p\s+float/,globalDefaultprecision="#ifdef GL_FRAGMENT_PRECISION_HIGH\n precision highp float;\n #else\n precision mediump float;\n#endif\n",includeRegExp=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g;function processModule(rawContent,includeList,type){return rawContent.replace(includeRegExp,function(_,strMatch){var includeName=strMatch.split(" ")[0].replace(/"/g,"");if(includeList.indexOf(includeName)>-1)return"";var txt=rawContentCache[includeName][type];return includeList.push(includeName),txt=processModule(txt,includeList,type)})}exports.registerModule=function registerModule(moduleName,_a){var vs=_a.vs,fs=_a.fs;rawContentCache[moduleName]={vs:vs,fs:fs}},exports.getModule=function getModule(moduleName){if(moduleCache[moduleName])return moduleCache[moduleName];var _a=rawContentCache[moduleName],vs=_a.vs,fs=_a.fs,vert=processModule(vs,[],SHADER_TYPE.VS),frag=processModule(fs,[],SHADER_TYPE.FS);return frag=function convertToWebGL2(content,type){return content}(frag,SHADER_TYPE.FS),precisionRegExp.test(frag)||(frag=globalDefaultprecision+frag),moduleCache[moduleName]={vs:vert,fs:frag},moduleCache[moduleName]}},386:function(module,exports,__webpack_require__){"use strict";(function(module){Object.defineProperty(exports,"__esModule",{value:!0});var react_1=__webpack_require__(81),theming_1=__webpack_require__(549);__webpack_require__(568),react_1.addParameters({options:{isFullscreen:!1,showAddonsPanel:!0,showSearchBox:!1,panelPosition:"bottom",hierarchySeparator:/\./,hierarchyRootSeparator:/\|/,enableShortcuts:!0,theme:theming_1.create({base:"light",brandTitle:"Custom Mapbox Layers",brandUrl:"https://github.com/storybookjs/storybook/tree/master/examples/cra-kitchen-sink",gridCellSize:12})}});var req=__webpack_require__(572);react_1.configure(function loadStories(){req.keys().forEach(req)},module)}).call(this,__webpack_require__(30)(module))},50:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),__webpack_require__(585);var PointCloudLayer_1=__webpack_require__(586);exports.PointCloudLayer=PointCloudLayer_1.default;var PointCloudLayer2_1=__webpack_require__(589);exports.PointCloudLayer2=PointCloudLayer2_1.default;var PointCloudLayer3_1=__webpack_require__(590);exports.PointCloudLayer3=PointCloudLayer3_1.default;var VectorTileClusterLayer_1=__webpack_require__(593);exports.VectorTileClusterLayer=VectorTileClusterLayer_1.default;var VectorTileLineLayer_1=__webpack_require__(603);exports.VectorTileLineLayer=VectorTileLineLayer_1.default;var TriangleLayer_1=__webpack_require__(637);exports.TriangleLayer=TriangleLayer_1.default;var LineLayer_1=__webpack_require__(638);exports.LineLayer=LineLayer_1.default;var Line3DLayer_1=__webpack_require__(639);exports.Line3DLayer=Line3DLayer_1.default;var TextLayer_1=__webpack_require__(640);exports.TextLayer=TextLayer_1.default;var CircleLayer_1=__webpack_require__(642);exports.CircleLayer=CircleLayer_1.default,__webpack_require__(643).compileBuiltinModules()},568:function(module,exports,__webpack_require__){var content=__webpack_require__(569);"string"==typeof content&&(content=[[module.i,content,""]]);var options={hmr:!0,transform:void 0,insertInto:void 0};__webpack_require__(254)(content,options);content.locals&&(module.exports=content.locals)},569:function(module,exports,__webpack_require__){(module.exports=__webpack_require__(570)(!1)).push([module.i,"html, body {\n  margin: 0; }\n",""])},572:function(module,exports,__webpack_require__){var map={"./LineLayer.stories.tsx":573,"./Point.stories.tsx":663,"./TextLayer.stories.tsx":670,"./VectorTile.stories.tsx":675};function webpackContext(req){var id=webpackContextResolve(req);return __webpack_require__(id)}function webpackContextResolve(req){if(!__webpack_require__.o(map,req)){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}return map[req]}webpackContext.keys=function webpackContextKeys(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id=572},573:function(module,exports,__webpack_require__){"use strict";(function(module){Object.defineProperty(exports,"__esModule",{value:!0});var React=__webpack_require__(1),react_1=__webpack_require__(81),LineLayer2D_1=__webpack_require__(574),LineLayer_md_1=__webpack_require__(662);react_1.storiesOf("LineLayer",module).add("2D",function(){return React.createElement(LineLayer2D_1.default,null)},{notes:{markdown:LineLayer_md_1.default}})}).call(this,__webpack_require__(30)(module))},574:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var React=__webpack_require__(1),react_mapbox_gl_1=__webpack_require__(51),dat=__webpack_require__(49),src_1=__webpack_require__(50),Map=react_mapbox_gl_1.default({accessToken:"pk.eyJ1IjoieGlhb2l2ZXIiLCJhIjoiY2pxcmc5OGNkMDY3cjQzbG42cXk5NTl3YiJ9.hUC5Chlqzzh0FFd_aEc-uQ"}),points=[[-122.3545851,37.9249513],[-122.3535851,37.9360513],[-122.3535851,37.9249513],[-122.300284,37.902646],[-122.2843653,37.8735039],[-122.269058,37.8694562],[-122.2709185,37.85301],[-122.2689342,37.8283973],[-122.2707195,37.8080566],[-122.2718706,37.804996],[-122.2948251,37.8064628],[-122.3971496,37.794745],[-122.4030149,37.7905282],[-122.4084631,37.7862646],[-122.4157833,37.7803439],[-122.4219476,37.7653052],[-122.4206096,37.7528545],[-122.4359052,37.7340058],[-122.448995,37.723273],[-122.471192,37.7067871],[-122.4672607,37.6842548],[-122.4449822,37.6635925],[-122.4169649,37.6372339],[-122.3876274,37.5993171]].map(function(p){return{lng:p[0],lat:p[1]}}),LineLayer2D=function(_super){function LineLayer2D(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(LineLayer2D,_super),LineLayer2D.prototype.componentDidMount=function(){var layer=new src_1.LineLayer({points:points,lineThickness:2.8});this.layer=layer,this.gui=new dat.GUI;var pointFolder=this.gui.addFolder("line");pointFolder.add(layer,"lineThickness",1,30).onChange(function(){layer.triggerRepaint()}),pointFolder.add(layer,"dashArray",0,1).onChange(function(){layer.triggerRepaint()}),pointFolder.add(layer,"dashOffset",0,1).onChange(function(){layer.triggerRepaint()}),pointFolder.add(layer,"dashRatio",0,1).onChange(function(){layer.triggerRepaint()})},LineLayer2D.prototype.componentWillUnmount=function(){this.gui.destroy()},LineLayer2D.prototype.render=function(){var _this=this;return React.createElement(Map,{style:"mapbox://styles/mapbox/light-v9",center:[-122.3535851,37.9360513],zoom:[12],containerStyle:{height:"100vh",width:"100vw"},onStyleLoad:function(map){if(map){var layers=map.getStyle().layers;if(layers&&layers.length){for(var labelLayerId=void 0,i=0;i<layers.length;i++)if(layers[i]&&"symbol"===layers[i].type&&layers[i].layout["text-field"]){labelLayerId=layers[i].id;break}map.addLayer(_this.layer,labelLayerId)}}}})},LineLayer2D}(React.Component);exports.default=LineLayer2D},586:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var mapboxgl=__webpack_require__(6),MapboxAdapterLayer_1=__webpack_require__(31),shader_module_1=__webpack_require__(38),web_mercator_1=__webpack_require__(61),PointCloudLayer=function(_super){function PointCloudLayer(options){var _this=_super.call(this)||this;return _this.id="pointcloud",_this.renderingMode="2d",_this.points=[],_this.pointSize=5,_this.pointColor=[13/255,64/255,140/255,1],_this.instance=!0,_this.isCircle=!0,Object.assign(_this,options),_this}return __extends(PointCloudLayer,_super),PointCloudLayer.prototype.getReglInitializationOptions=function(){var reglOptions={};return this.instance&&(reglOptions.extensions=["ANGLE_instanced_arrays","OES_standard_derivatives"]),reglOptions},PointCloudLayer.prototype.init=function(map,gl){this.points=this.points.map(function(p){var _a=mapboxgl.MercatorCoordinate.fromLngLat({lng:p.lng,lat:p.lat});return[_a.x,_a.y]});var _a=shader_module_1.getModule("point1"),vs=_a.vs,reglDrawConfig={frag:_a.fs,vert:vs,attributes:{a_color:[this.pointColor],a_pos:{buffer:this.regl.buffer({data:this.points,type:"float32"}),divisor:1}},uniforms:{u_matrix:this.regl.prop("u_matrix"),u_point_size:this.regl.prop("u_point_size"),u_is_circle:this.regl.prop("u_is_circle"),u_is_offset:this.regl.prop("u_is_offset"),u_pixels_per_degree:this.regl.prop("u_pixels_per_degree"),u_pixels_per_degree2:this.regl.prop("u_pixels_per_degree2"),u_pixels_per_meter:this.regl.prop("u_pixels_per_meter"),u_viewport_center:this.regl.prop("u_viewport_center"),u_viewport_center_projection:this.regl.prop("u_viewport_center_projection"),u_scale:this.regl.prop("u_scale")},primitive:"points",depth:{enable:!1},count:1,instances:this.points.length,blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:1}}};this.drawPoints=this.regl(reglDrawConfig)},PointCloudLayer.prototype.frame=function(gl,m){var currentZoomLevel=this.map.getZoom(),currentScale=web_mercator_1.zoomToScale(currentZoomLevel),drawParams={u_matrix:m,u_point_size:this.pointSize,u_is_circle:this.isCircle,u_is_offset:!1,u_pixels_per_degree:[0,0,0],u_scale:currentScale,u_pixels_per_degree2:[0,0,0],u_viewport_center:[0,0],u_pixels_per_meter:[0,0,0],u_viewport_center_projection:[0,0,0,0]};this.drawPoints(drawParams)},PointCloudLayer}(MapboxAdapterLayer_1.default);exports.default=PointCloudLayer},589:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var mat4=__webpack_require__(4),vec4=__webpack_require__(9),MapboxAdapterLayer_1=__webpack_require__(31),web_mercator_1=__webpack_require__(61),viewport_mercator_project_1=__webpack_require__(167),shader_module_1=__webpack_require__(38),PointCloudLayer2=function(_super){function PointCloudLayer2(options){var _this=_super.call(this)||this;return _this.id="pointcloud",_this.points=[],_this.pointSize=5,_this.pointColor=[13/255,64/255,140/255,1],_this.instance=!0,_this.isCircle=!0,Object.assign(_this,options),_this}return __extends(PointCloudLayer2,_super),PointCloudLayer2.prototype.getReglInitializationOptions=function(){var reglOptions={};return this.instance&&(reglOptions.extensions=["ANGLE_instanced_arrays","OES_standard_derivatives"]),reglOptions},PointCloudLayer2.prototype.init=function(map,gl){var points=this.points.reduce(function(prev,cur){return prev.push([Math.fround(Number(cur.lng)),Math.fround(Number(cur.lat))]),prev},[]),_a=shader_module_1.getModule("point2"),vs=_a.vs,reglDrawConfig={frag:_a.fs,vert:vs,attributes:{a_color:[this.pointColor],a_pos:{buffer:this.regl.buffer({data:points,type:"float32"}),divisor:1}},uniforms:{u_matrix:this.regl.prop("u_matrix"),u_point_size:this.regl.prop("u_point_size"),u_is_circle:this.regl.prop("u_is_circle"),u_is_offset:this.regl.prop("u_is_offset"),u_pixels_per_degree:this.regl.prop("u_pixels_per_degree"),u_pixels_per_degree2:this.regl.prop("u_pixels_per_degree2"),u_pixels_per_meter:this.regl.prop("u_pixels_per_meter"),u_viewport_center:this.regl.prop("u_viewport_center"),u_project_scale:this.regl.prop("u_project_scale"),u_viewport_center_projection:this.regl.prop("u_viewport_center_projection")},primitive:"points",depth:{enable:!1},count:1,instances:points.length,blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:1}}};this.drawPoints=this.regl(reglDrawConfig)},PointCloudLayer2.prototype.frame=function(gl,matrix){var currentZoomLevel=this.map.getZoom(),bearing=this.map.getBearing(),pitch=this.map.getPitch(),center=this.map.getCenter(),viewport=new viewport_mercator_project_1.default({width:gl.drawingBufferWidth/2,height:gl.drawingBufferHeight/2,longitude:center.lng,latitude:center.lat,zoom:currentZoomLevel,pitch:pitch,bearing:bearing}),viewProjectionMatrix=viewport.viewProjectionMatrix,projectionMatrix=viewport.projectionMatrix,viewMatrix=viewport.viewMatrix,viewMatrixUncentered=viewport.viewMatrixUncentered,drawParams={u_matrix:viewProjectionMatrix,u_point_size:this.pointSize,u_is_circle:this.isCircle,u_is_offset:!1,u_pixels_per_degree:[0,0,0],u_pixels_per_degree2:[0,0,0],u_viewport_center:[0,0],u_pixels_per_meter:[0,0,0],u_project_scale:web_mercator_1.zoomToScale(currentZoomLevel),u_viewport_center_projection:[0,0,0,0]};if(currentZoomLevel>12){var _a=web_mercator_1.getDistanceScales({longitude:center.lng,latitude:center.lat,zoom:currentZoomLevel,highPrecision:!0}),pixelsPerDegree=_a.pixelsPerDegree,pixelsPerDegree2=_a.pixelsPerDegree2,positionPixels=viewport.projectFlat([Math.fround(center.lng),Math.fround(center.lat)],Math.pow(2,currentZoomLevel)),projectionCenter=vec4.transformMat4([],[positionPixels[0],positionPixels[1],0,1],viewProjectionMatrix),viewMatrix2=viewMatrixUncentered||viewMatrix,viewProjectionMatrix2=mat4.multiply([],projectionMatrix,viewMatrix2);viewProjectionMatrix2=mat4.multiply([],viewProjectionMatrix2,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0]),drawParams.u_matrix=viewProjectionMatrix2,drawParams.u_is_offset=!0,drawParams.u_viewport_center=[Math.fround(center.lng),Math.fround(center.lat)],drawParams.u_viewport_center_projection=projectionCenter,drawParams.u_pixels_per_degree=pixelsPerDegree&&pixelsPerDegree.map(function(p){return Math.fround(p)}),drawParams.u_pixels_per_degree2=pixelsPerDegree2&&pixelsPerDegree2.map(function(p){return Math.fround(p)})}this.drawPoints(drawParams)},PointCloudLayer2}(MapboxAdapterLayer_1.default);exports.default=PointCloudLayer2},590:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var mapboxgl=__webpack_require__(6),MapboxAdapterLayer_1=__webpack_require__(31),point_vs_extrude_glsl_1=__webpack_require__(591),point_fs_extrude_glsl_1=__webpack_require__(592),PointCloudLayer3=function(_super){function PointCloudLayer3(options){var _this=_super.call(this)||this;return _this.id="pointcloud",_this.renderingMode="2d",_this.points=[],_this.pointSize=50,_this.pointColor=[13/255,64/255,140/255,1],_this.instance=!0,_this.isCircle=!0,Object.assign(_this,options),_this}return __extends(PointCloudLayer3,_super),PointCloudLayer3.prototype.getReglInitializationOptions=function(){var reglOptions={};return this.instance&&(reglOptions.extensions=["ANGLE_instanced_arrays"]),reglOptions},PointCloudLayer3.prototype.init=function(map,gl){this.points=this.points.slice(0,4).map(function(p){var _a=mapboxgl.MercatorCoordinate.fromLngLat({lng:p.lng,lat:p.lat});return[_a.x,_a.y]});for(var N=this.points.length,unit=[],i=0;i<N;i++)unit=unit.concat([[-1,-1],[1,-1],[1,1],[-1,1]]);var points=[];for(i=0;i<N;i++)points=points.concat([this.points[i],this.points[i],this.points[i],this.points[i]]);var colors=[];for(i=0;i<N;i++)colors=colors.concat([this.pointColor,this.pointColor,this.pointColor,this.pointColor]);var reglDrawConfig={frag:point_fs_extrude_glsl_1.default,vert:point_vs_extrude_glsl_1.default,attributes:{a_color:colors,a_unit:unit,a_pos:points},uniforms:{u_matrix:this.regl.prop("u_matrix"),u_extrude_scale:this.regl.prop("u_extrude_scale")},primitive:"triangle fan",depth:{enable:!1},count:4,instances:N,blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:1}}};this.drawPoints=this.regl(reglDrawConfig)},PointCloudLayer3.prototype.frame=function(gl,m){var drawParams={u_matrix:m,u_extrude_scale:[2/gl.drawingBufferWidth,-2/gl.drawingBufferHeight]};this.drawPoints(drawParams)},PointCloudLayer3}(MapboxAdapterLayer_1.default);exports.default=PointCloudLayer3},591:function(module,exports){module.exports="attribute vec2 a_pos;\nattribute vec2 a_unit;\nattribute vec4 a_color;\n\nuniform mat4 u_matrix;\nuniform vec2 u_extrude_scale;\n\nvarying vec4 v_color;\n// varying vec2 v_unit;\nvarying vec3 v_data;\n\n#define DEVICE_PIXEL_RATIO 2.0\n\nvoid main() {\n    v_color = a_color;\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n    gl_Position.xy += a_unit * (50.0) * u_extrude_scale * gl_Position.w;\n\n    lowp float antialiasblur = 1.0 / DEVICE_PIXEL_RATIO / (50.0);\n\n    v_data = vec3(a_unit.x, a_unit.y, antialiasblur);\n}"},592:function(module,exports){module.exports="precision highp float;\n\nvarying vec4 v_color;\nvarying vec3 v_data;\n\nvoid main() {\n    // float r = length(v_unit);\n    // if (r > 1.0) {\n    //     discard;\n    // }\n    // gl_FragColor = v_color;\n\n    vec2 extrude = v_data.xy;\n    float extrude_length = length(extrude);\n\n    lowp float antialiasblur = v_data.z;\n    float antialiased_blur = -max(0.0, antialiasblur);\n\n    float opacity_t = smoothstep(0.0, antialiased_blur, extrude_length - 1.0);\n\n    // float color_t = stroke_width < 0.01 ? 0.0 : smoothstep(\n    //     antialiased_blur,\n    //     0.0,\n    //     extrude_length - radius / (radius + stroke_width)\n    // );\n\n    float color_t = 0.0;\n\n    // gl_FragColor = opacity_t * mix(color * opacity, stroke_color * stroke_opacity, color_t);\n    gl_FragColor = opacity_t * v_color;\n}"},593:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var mat4=__webpack_require__(4),supercluster_1=__webpack_require__(682),MapboxAdapterLayer_1=__webpack_require__(31),shader_module_1=__webpack_require__(38),web_mercator_1=__webpack_require__(61),tile_cover_1=__webpack_require__(162),mercator_coordinate_1=__webpack_require__(117),tile_id_1=__webpack_require__(68),glyph_manager_1=__webpack_require__(256),symbol_layout_1=__webpack_require__(258),GlyphAtlas_1=__webpack_require__(259),SymbolQuad_1=__webpack_require__(260),symbol_projection_1=__webpack_require__(163),vertex_compression_1=__webpack_require__(261),sdf_2d_1=__webpack_require__(164),CollisionIndex_1=__webpack_require__(262),compareClusterText=function(t1,t2){return t2.weight-t1.weight},VectorTileClusterLayer=function(_super){function VectorTileClusterLayer(options){var _this=_super.call(this)||this;return _this.id="cluster",_this.renderingMode="2d",_this.geoJSON={},_this.pointColor=[81,187,214],_this.pointRadius=10,_this.pointOpacity=1,_this.strokeWidth=2,_this.strokeColor=[255,255,255],_this.strokeOpacity=1,_this.fontSize=14,_this.fontColor=[0,0,0],_this.fontOpacity=1,_this.haloColor=[255,255,255],_this.haloWidth=1,_this.haloBlur=.2,_this.symbolAnchor="center",_this.textJustify="center",_this.textSpacing=2,_this.textOffsetX=0,_this.textOffsetY=0,_this.debug=!1,_this.posMatrixCache={},Object.assign(_this,options),_this}return __extends(VectorTileClusterLayer,_super),VectorTileClusterLayer.prototype.getReglInitializationOptions=function(){var reglOptions={extensions:["ANGLE_instanced_arrays","OES_standard_derivatives"]};return reglOptions},VectorTileClusterLayer.prototype.init=function(map,gl){this.tileIndex=new supercluster_1.default({maxZoom:17,extent:tile_id_1.EXTENT,radius:50*tile_id_1.EXTENT/512}),this.tileIndex.load(this.geoJSON),this.initDrawCircleCommand(),this.initDrawTextCommand(),this.initDrawDebugSDFCommand(),this.initGlyphAtlas()},VectorTileClusterLayer.prototype.initDrawCircleCommand=function(){var _a=shader_module_1.getModule("circle"),vs=_a.vs,reglDrawConfig={frag:_a.fs,vert:vs,attributes:{a_packed_data:this.regl.prop("a_packed_data"),a_packed_data2:this.regl.prop("a_packed_data2"),a_packed_data3:this.regl.prop("a_packed_data3")},uniforms:{u_matrix:this.regl.prop("u_matrix"),u_extrude_scale:this.map.transform.pixelsToGLUnits},primitive:"triangles",elements:this.regl.prop("elements"),cull:{enable:!1,face:"back"}};this.drawCircles=this.regl(reglDrawConfig)},VectorTileClusterLayer.prototype.initDrawTextCommand=function(){var _this=this,_a=shader_module_1.getModule("sdf"),vs=_a.vs,reglDrawConfig={frag:_a.fs,vert:vs,attributes:{a_pos:this.regl.prop("a_pos"),a_tex:this.regl.prop("a_tex"),a_offset:this.regl.prop("a_offset")},uniforms:{u_matrix:this.regl.prop("u_matrix"),u_label_matrix:this.regl.prop("u_label_matrix"),u_gl_matrix:this.regl.prop("u_gl_matrix"),u_sdf_map:this.regl.prop("u_sdf_map"),u_gamma_scale:Math.cos(this.map.transform._pitch),u_extrude_scale:this.map.transform.pixelsToGLUnits,u_sdf_map_size:this.regl.prop("u_sdf_map_size"),u_font_size:function(){return _this.fontSize},u_font_color:function(){return _this.fontColor.map(function(c){return c/255}).concat([1])},u_font_opacity:function(){return _this.fontOpacity},u_halo_width:function(){return _this.haloWidth},u_halo_blur:function(){return _this.haloBlur},u_halo_color:function(){return _this.haloColor.map(function(c){return c/255}).concat([1])},u_debug:function(){return _this.debug}},primitive:"triangles",elements:this.regl.prop("elements")};this.drawText=this.regl(reglDrawConfig)},VectorTileClusterLayer.prototype.initDrawDebugSDFCommand=function(){var _a=shader_module_1.getModule("quad"),vs=_a.vs,reglDrawConfig={frag:_a.fs,vert:vs,attributes:{a_extrude:[[-1,-1],[1,-1],[1,1],[-1,1]]},uniforms:{u_sdf_map:this.regl.prop("u_sdf_map")},primitive:"triangles",elements:[[0,1,2],[2,3,0]]};this.drawDebugSDF=this.regl(reglDrawConfig)},VectorTileClusterLayer.prototype.initGlyphAtlas=function(){var glyphMap="0123456789包含个点".split("").map(function(char){return glyph_manager_1.generateSDF("",char)}).reduce(function(prev,cur){return prev[cur.id]=cur,prev},{});this.glyphMap||(this.glyphMap={}),this.glyphMap["sans-serif"]=glyphMap,this.glyphAtlas=new GlyphAtlas_1.default(this.glyphMap),this.glyphAtlasTexture=this.regl.texture()},VectorTileClusterLayer.prototype.buildClusterBuffers=function(clusters){var packedBuffer=[],packedBuffer2=[],packedBuffer3=[],textArray=[],indexBuffer=[],i=0;return clusters.forEach(function(cluster){var radius,color,_a=cluster.geometry[0],tileX=_a[0],tileY=_a[1],pointCount=cluster.tags.point_count;pointCount>30?(radius=40,color=[242,140,177,255]):pointCount>10?(radius=30,color=[241,240,117,255]):(radius=20,color=[81,187,214,255]);var _b=vertex_compression_1.packCircleVertex({color:color,radius:radius,tileX:tileX,tileY:tileY,shape:"circle",opacity:1,strokeColor:[255,255,255,255],strokeOpacity:0,strokeWidth:0}),packed1=_b.packedBuffer,packed2=_b.packedBuffer2,packed3=_b.packedBuffer3;packedBuffer.push.apply(packedBuffer,packed1),packedBuffer2.push.apply(packedBuffer2,packed2),packedBuffer3.push.apply(packedBuffer3,packed3),indexBuffer.push([0+i,1+i,2+i]),indexBuffer.push([2+i,3+i,0+i]),i+=4,textArray.push({text:"包含"+pointCount+"个点",position:cluster.geometry[0],weight:pointCount})}),{packedBuffer:packedBuffer,packedBuffer2:packedBuffer2,packedBuffer3:packedBuffer3,indexBuffer:indexBuffer,textArray:textArray}},VectorTileClusterLayer.prototype.buildPointBuffers=function(clusters){var _this=this,packedBuffer=[],packedBuffer2=[],packedBuffer3=[],indexBuffer=[],i=0;return clusters.forEach(function(cluster,index){var _a=cluster.geometry[0],tileX=_a[0],tileY=_a[1],_b=vertex_compression_1.packCircleVertex({color:_this.pointColor.concat([255]),radius:_this.pointRadius,tileX:tileX,tileY:tileY,shape:sdf_2d_1.sdf2DFunctions[index%sdf_2d_1.sdf2DFunctions.length],opacity:_this.pointOpacity,strokeColor:_this.strokeColor.concat([255]),strokeOpacity:_this.strokeOpacity,strokeWidth:_this.strokeWidth}),packed1=_b.packedBuffer,packed2=_b.packedBuffer2,packed3=_b.packedBuffer3;packedBuffer.push.apply(packedBuffer,packed1),packedBuffer2.push.apply(packedBuffer2,packed2),packedBuffer3.push.apply(packedBuffer3,packed3),indexBuffer.push([0+i,1+i,2+i]),indexBuffer.push([2+i,3+i,0+i]),i+=4}),{packedBuffer:packedBuffer,packedBuffer2:packedBuffer2,packedBuffer3:packedBuffer3,indexBuffer:indexBuffer}},VectorTileClusterLayer.prototype.buildTextBuffers=function(textArray,posMatrix){var _this=this,charPositionBuffer=[],charUVBuffer=[],charOffsetBuffer=[],indexBuffer=[],textOffset=[this.textOffsetX,this.textOffsetY],textPixelRatio=symbol_projection_1.tileSize/tile_id_1.EXTENT,fontScale=this.fontSize/24;textArray.sort(compareClusterText);var i=0;return textArray.forEach(function(_a){var text=_a.text,position=_a.position,shaping=symbol_layout_1.shapeText(text,_this.glyphMap,"sans-serif",0,24,_this.symbolAnchor,_this.textJustify,_this.textSpacing,textOffset,1);if(shaping){var box=_this.collisionIndex.placeCollisionBox({x1:shaping.left*fontScale,x2:shaping.right*fontScale,y1:shaping.top*fontScale,y2:shaping.bottom*fontScale,anchorPointX:position[0],anchorPointY:position[1]},!1,textPixelRatio,posMatrix).box;if(box&&box.length)_this.collisionIndex.insertCollisionBox(box,0,0,0),SymbolQuad_1.getGlyphQuads(shaping,textOffset,!1,_this.glyphAtlas.positions).forEach(function(quad){charPositionBuffer.push(position),charPositionBuffer.push(position),charPositionBuffer.push(position),charPositionBuffer.push(position),charUVBuffer.push([quad.tex.x,quad.tex.y]),charUVBuffer.push([quad.tex.x+quad.tex.w,quad.tex.y]),charUVBuffer.push([quad.tex.x+quad.tex.w,quad.tex.y+quad.tex.h]),charUVBuffer.push([quad.tex.x,quad.tex.y+quad.tex.h]),charOffsetBuffer.push([quad.tl.x,quad.tl.y]),charOffsetBuffer.push([quad.tr.x,quad.tr.y]),charOffsetBuffer.push([quad.br.x,quad.br.y]),charOffsetBuffer.push([quad.bl.x,quad.bl.y]),indexBuffer.push([0+i,1+i,2+i]),indexBuffer.push([2+i,3+i,0+i]),i+=4})}}),{indexBuffer:indexBuffer,charPositionBuffer:charPositionBuffer,charUVBuffer:charUVBuffer,charOffsetBuffer:charOffsetBuffer}},VectorTileClusterLayer.prototype.renderClusters=function(clusters,posMatrix,overscaledZ){var _a=this.glyphAtlas.image,width=_a.width,height=_a.height,data=_a.data,s=symbol_projection_1.pixelsToTileUnits(overscaledZ,1,this.map.transform.zoom),labelPlaneMatrix=symbol_projection_1.getLabelPlaneMatrix(posMatrix,!1,!1,this.map.transform,s),glCoordMatrix=symbol_projection_1.getGlCoordMatrix(posMatrix,!1,!1,this.map.transform,s),_b=this.buildClusterBuffers(clusters),packedBuffer=_b.packedBuffer,packedBuffer2=_b.packedBuffer2,packedBuffer3=_b.packedBuffer3,circleIndexes=_b.indexBuffer,textArray=_b.textArray;this.drawCircles({u_matrix:posMatrix,a_packed_data:{buffer:this.regl.buffer({usage:"dynamic",data:packedBuffer})},a_packed_data2:{buffer:this.regl.buffer({usage:"dynamic",data:packedBuffer2})},a_packed_data3:{buffer:this.regl.buffer({usage:"dynamic",data:packedBuffer3})},elements:circleIndexes});var _c=this.buildTextBuffers(textArray,posMatrix),textIndexes=_c.indexBuffer,charOffsetBuffer=_c.charOffsetBuffer,charPositionBuffer=_c.charPositionBuffer,charUVBuffer=_c.charUVBuffer;this.drawText({u_matrix:posMatrix,u_label_matrix:labelPlaneMatrix,u_gl_matrix:glCoordMatrix,a_pos:{buffer:this.regl.buffer(charPositionBuffer)},a_tex:{buffer:this.regl.buffer(charUVBuffer)},a_offset:{buffer:this.regl.buffer(charOffsetBuffer)},u_sdf_map:this.glyphAtlasTexture({width:width,height:height,mag:"linear",min:"linear",format:"alpha",data:data}),u_sdf_map_size:[width,height],elements:textIndexes})},VectorTileClusterLayer.prototype.renderPoints=function(clusters,posMatrix){var _a=this.buildPointBuffers(clusters),packedBuffer=_a.packedBuffer,packedBuffer2=_a.packedBuffer2,packedBuffer3=_a.packedBuffer3,indexBuffer=_a.indexBuffer;this.drawCircles({u_matrix:posMatrix,a_packed_data:{buffer:this.regl.buffer({usage:"dynamic",data:packedBuffer})},a_packed_data2:{buffer:this.regl.buffer({usage:"dynamic",data:packedBuffer2})},a_packed_data3:{buffer:this.regl.buffer({usage:"dynamic",data:packedBuffer3})},elements:indexBuffer})},VectorTileClusterLayer.prototype.renderTiles=function(){var _this=this;this.cleanPosMatrixCache();var currentZoomLevel=this.map.getZoom(),currentScale=web_mercator_1.zoomToScale(currentZoomLevel),flooredZoom=Math.floor(currentZoomLevel),bounds=this.map.getBounds();tile_cover_1.default(flooredZoom,[mercator_coordinate_1.default.fromLngLat(bounds.getSouthWest()),mercator_coordinate_1.default.fromLngLat(bounds.getNorthEast()),mercator_coordinate_1.default.fromLngLat(bounds.getNorthWest()),mercator_coordinate_1.default.fromLngLat(bounds.getSouthEast())],flooredZoom,!1).forEach(function(tile){tile.posMatrix=_this.calculatePosMatrix(tile.toUnwrapped(),currentScale);var t=_this.tileIndex.getTile(tile.canonical.z,tile.canonical.x,tile.canonical.y);if(t&&t.features&&t.features.length){var clusters=t.features.filter(function(f){return f.id}),singlePoints=t.features.filter(function(f){return!f.id});_this.renderPoints(singlePoints,tile.posMatrix),_this.renderClusters(clusters,tile.posMatrix,tile.overscaledZ)}})},VectorTileClusterLayer.prototype.frame=function(gl,m){if(this.collisionIndex=new CollisionIndex_1.default(this.map.transform),this.renderTiles(),this.debug){var _a=this.glyphAtlas.image,width=_a.width,height=_a.height,data=_a.data;this.drawDebugSDF({u_sdf_map:this.glyphAtlasTexture({width:width,height:height,mag:"linear",min:"linear",format:"alpha",flipY:!0,data:data})})}},VectorTileClusterLayer.prototype.calculatePosMatrix=function(unwrappedTileID,currentScale){var posMatrixKey=unwrappedTileID.key,cache=this.posMatrixCache;if(cache[posMatrixKey])return cache[posMatrixKey];var canonical=unwrappedTileID.canonical,scale=web_mercator_1.TILE_SIZE*currentScale/web_mercator_1.zoomToScale(canonical.z),unwrappedX=canonical.x+Math.pow(2,canonical.z)*unwrappedTileID.wrap,posMatrix=mat4.identity(new Float64Array(16));return mat4.translate(posMatrix,posMatrix,[unwrappedX*scale,canonical.y*scale,0]),mat4.scale(posMatrix,posMatrix,[scale/tile_id_1.EXTENT,scale/tile_id_1.EXTENT,1]),mat4.multiply(posMatrix,this.map.transform.projMatrix,posMatrix),cache[posMatrixKey]=new Float32Array(posMatrix),cache[posMatrixKey]},VectorTileClusterLayer.prototype.cleanPosMatrixCache=function(){this.posMatrixCache={}},VectorTileClusterLayer}(MapboxAdapterLayer_1.default);exports.default=VectorTileClusterLayer},594:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var lng_lat_1=__webpack_require__(255),LngLatBounds=function(){function LngLatBounds(sw,ne){sw&&(ne?this.setSouthWest(sw).setNorthEast(ne):4===sw.length?this.setSouthWest([sw[0],sw[1]]).setNorthEast([sw[2],sw[3]]):this.setSouthWest(sw[0]).setNorthEast(sw[1]))}return LngLatBounds.prototype.setNorthEast=function(ne){return this._ne=ne instanceof lng_lat_1.default?new lng_lat_1.default(ne.lng,ne.lat):lng_lat_1.default.convert(ne),this},LngLatBounds.prototype.setSouthWest=function(sw){return this._sw=sw instanceof lng_lat_1.default?new lng_lat_1.default(sw.lng,sw.lat):lng_lat_1.default.convert(sw),this},LngLatBounds.prototype.extend=function(obj){var sw2,ne2,sw=this._sw,ne=this._ne;if(obj instanceof lng_lat_1.default)sw2=obj,ne2=obj;else{if(!(obj instanceof LngLatBounds))return Array.isArray(obj)?obj.every(Array.isArray)?this.extend(LngLatBounds.convert(obj)):this.extend(lng_lat_1.default.convert(obj)):this;if(sw2=obj._sw,ne2=obj._ne,!sw2||!ne2)return this}return sw||ne?(sw.lng=Math.min(sw2.lng,sw.lng),sw.lat=Math.min(sw2.lat,sw.lat),ne.lng=Math.max(ne2.lng,ne.lng),ne.lat=Math.max(ne2.lat,ne.lat)):(this._sw=new lng_lat_1.default(sw2.lng,sw2.lat),this._ne=new lng_lat_1.default(ne2.lng,ne2.lat)),this},LngLatBounds.prototype.getCenter=function(){return new lng_lat_1.default((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},LngLatBounds.prototype.getSouthWest=function(){return this._sw},LngLatBounds.prototype.getNorthEast=function(){return this._ne},LngLatBounds.prototype.getNorthWest=function(){return new lng_lat_1.default(this.getWest(),this.getNorth())},LngLatBounds.prototype.getSouthEast=function(){return new lng_lat_1.default(this.getEast(),this.getSouth())},LngLatBounds.prototype.getWest=function(){return this._sw.lng},LngLatBounds.prototype.getSouth=function(){return this._sw.lat},LngLatBounds.prototype.getEast=function(){return this._ne.lng},LngLatBounds.prototype.getNorth=function(){return this._ne.lat},LngLatBounds.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},LngLatBounds.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},LngLatBounds.prototype.isEmpty=function(){return!(this._sw&&this._ne)},LngLatBounds.convert=function(input){return!input||input instanceof LngLatBounds?input:new LngLatBounds(input)},LngLatBounds}();exports.default=LngLatBounds},602:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var GridIndex=function(){function GridIndex(width,height,cellSize){var boxCells=this.boxCells=[],circleCells=this.circleCells=[];this.xCellCount=Math.ceil(width/cellSize),this.yCellCount=Math.ceil(height/cellSize);for(var i=0;i<this.xCellCount*this.yCellCount;i++)boxCells.push([]),circleCells.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=width,this.height=height,this.xScale=this.xCellCount/width,this.yScale=this.yCellCount/height,this.boxUid=0,this.circleUid=0}return GridIndex.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},GridIndex.prototype.insert=function(key,x1,y1,x2,y2){this._forEachCell(x1,y1,x2,y2,this._insertBoxCell,this.boxUid++),this.boxKeys.push(key),this.bboxes.push(x1),this.bboxes.push(y1),this.bboxes.push(x2),this.bboxes.push(y2)},GridIndex.prototype.insertCircle=function(key,x,y,radius){this._forEachCell(x-radius,y-radius,x+radius,y+radius,this._insertCircleCell,this.circleUid++),this.circleKeys.push(key),this.circles.push(x),this.circles.push(y),this.circles.push(radius)},GridIndex.prototype._insertBoxCell=function(x1,y1,x2,y2,cellIndex,uid){this.boxCells[cellIndex].push(uid)},GridIndex.prototype._insertCircleCell=function(x1,y1,x2,y2,cellIndex,uid){this.circleCells[cellIndex].push(uid)},GridIndex.prototype._query=function(x1,y1,x2,y2,hitTest,predicate){if(x2<0||x1>this.width||y2<0||y1>this.height)return!hitTest&&[];var result=[];if(x1<=0&&y1<=0&&this.width<=x2&&this.height<=y2){if(hitTest)return!0;for(var boxUid=0;boxUid<this.boxKeys.length;boxUid++)result.push({key:this.boxKeys[boxUid],x1:this.bboxes[4*boxUid],y1:this.bboxes[4*boxUid+1],x2:this.bboxes[4*boxUid+2],y2:this.bboxes[4*boxUid+3]});for(var circleUid=0;circleUid<this.circleKeys.length;circleUid++){var x=this.circles[3*circleUid],y=this.circles[3*circleUid+1],radius=this.circles[3*circleUid+2];result.push({key:this.circleKeys[circleUid],x1:x-radius,y1:y-radius,x2:x+radius,y2:y+radius})}return predicate?result.filter(predicate):result}var queryArgs={hitTest:hitTest,seenUids:{box:{},circle:{}}};return this._forEachCell(x1,y1,x2,y2,this._queryCell,result,queryArgs,predicate),hitTest?result.length>0:result},GridIndex.prototype._queryCircle=function(x,y,radius,hitTest,predicate){var x1=x-radius,x2=x+radius,y1=y-radius,y2=y+radius;if(x2<0||x1>this.width||y2<0||y1>this.height)return!hitTest&&[];var result=[],queryArgs={hitTest:hitTest,circle:{x:x,y:y,radius:radius},seenUids:{box:{},circle:{}}};return this._forEachCell(x1,y1,x2,y2,this._queryCellCircle,result,queryArgs,predicate),hitTest?result.length>0:result},GridIndex.prototype.query=function(x1,y1,x2,y2,predicate){return this._query(x1,y1,x2,y2,!1,predicate)},GridIndex.prototype.hitTest=function(x1,y1,x2,y2,predicate){return this._query(x1,y1,x2,y2,!0,predicate)},GridIndex.prototype.hitTestCircle=function(x,y,radius,predicate){return this._queryCircle(x,y,radius,!0,predicate)},GridIndex.prototype._queryCell=function(x1,y1,x2,y2,cellIndex,result,queryArgs,predicate){var seenUids=queryArgs.seenUids,boxCell=this.boxCells[cellIndex];if(null!==boxCell)for(var bboxes=this.bboxes,_i=0,boxCell_1=boxCell;_i<boxCell_1.length;_i++){var boxUid=boxCell_1[_i];if(!seenUids.box[boxUid])if(seenUids.box[boxUid]=!0,x1<=bboxes[(offset=4*boxUid)+2]&&y1<=bboxes[offset+3]&&x2>=bboxes[offset+0]&&y2>=bboxes[offset+1]&&(!predicate||predicate(this.boxKeys[boxUid]))){if(queryArgs.hitTest)return result.push(!0),!0;result.push({key:this.boxKeys[boxUid],x1:bboxes[offset],y1:bboxes[offset+1],x2:bboxes[offset+2],y2:bboxes[offset+3]})}}var circleCell=this.circleCells[cellIndex];if(null!==circleCell)for(var circles=this.circles,_a=0,circleCell_1=circleCell;_a<circleCell_1.length;_a++){var circleUid=circleCell_1[_a];if(!seenUids.circle[circleUid]){seenUids.circle[circleUid]=!0;var offset=3*circleUid;if(this._circleAndRectCollide(circles[offset],circles[offset+1],circles[offset+2],x1,y1,x2,y2)&&(!predicate||predicate(this.circleKeys[circleUid]))){if(queryArgs.hitTest)return result.push(!0),!0;var x=circles[offset],y=circles[offset+1],radius=circles[offset+2];result.push({key:this.circleKeys[circleUid],x1:x-radius,y1:y-radius,x2:x+radius,y2:y+radius})}}}return!1},GridIndex.prototype._queryCellCircle=function(x1,y1,x2,y2,cellIndex,result,queryArgs,predicate){var circle=queryArgs.circle,seenUids=queryArgs.seenUids,boxCell=this.boxCells[cellIndex];if(null!==boxCell)for(var bboxes=this.bboxes,_i=0,boxCell_2=boxCell;_i<boxCell_2.length;_i++){var boxUid=boxCell_2[_i];if(!seenUids.box[boxUid]){seenUids.box[boxUid]=!0;var offset=4*boxUid;if(this._circleAndRectCollide(circle.x,circle.y,circle.radius,bboxes[offset+0],bboxes[offset+1],bboxes[offset+2],bboxes[offset+3])&&(!predicate||predicate(this.boxKeys[boxUid])))return result.push(!0),!0}}var circleCell=this.circleCells[cellIndex];if(null!==circleCell)for(var circles=this.circles,_a=0,circleCell_2=circleCell;_a<circleCell_2.length;_a++){var circleUid=circleCell_2[_a];if(!seenUids.circle[circleUid]){seenUids.circle[circleUid]=!0;offset=3*circleUid;if(this._circlesCollide(circles[offset],circles[offset+1],circles[offset+2],circle.x,circle.y,circle.radius)&&(!predicate||predicate(this.circleKeys[circleUid])))return result.push(!0),!0}}return!1},GridIndex.prototype._forEachCell=function(x1,y1,x2,y2,fn,arg1,arg2,predicate){for(var cx1=this._convertToXCellCoord(x1),cy1=this._convertToYCellCoord(y1),cx2=this._convertToXCellCoord(x2),cy2=this._convertToYCellCoord(y2),x=cx1;x<=cx2;x++)for(var y=cy1;y<=cy2;y++){var cellIndex=this.xCellCount*y+x;if(fn.call(this,x1,y1,x2,y2,cellIndex,arg1,arg2,predicate))return}},GridIndex.prototype._convertToXCellCoord=function(x){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(x*this.xScale)))},GridIndex.prototype._convertToYCellCoord=function(y){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(y*this.yScale)))},GridIndex.prototype._circlesCollide=function(x1,y1,r1,x2,y2,r2){var dx=x2-x1,dy=y2-y1,bothRadii=r1+r2;return bothRadii*bothRadii>dx*dx+dy*dy},GridIndex.prototype._circleAndRectCollide=function(circleX,circleY,radius,x1,y1,x2,y2){var halfRectWidth=(x2-x1)/2,distX=Math.abs(circleX-(x1+halfRectWidth));if(distX>halfRectWidth+radius)return!1;var halfRectHeight=(y2-y1)/2,distY=Math.abs(circleY-(y1+halfRectHeight));if(distY>halfRectHeight+radius)return!1;if(distX<=halfRectWidth||distY<=halfRectHeight)return!0;var dx=distX-halfRectWidth,dy=distY-halfRectHeight;return dx*dx+dy*dy<=radius*radius},GridIndex}();exports.default=GridIndex},603:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var mat4=__webpack_require__(4),geojson_vt_1=__webpack_require__(276),MapboxAdapterLayer_1=__webpack_require__(31),shader_module_1=__webpack_require__(38),web_mercator_1=__webpack_require__(61),tile_cover_1=__webpack_require__(162),polyline_normals_1=__webpack_require__(263),mercator_coordinate_1=__webpack_require__(117),tile_id_1=__webpack_require__(68),VectorTileLineLayer=function(_super){function VectorTileLineLayer(options){var _this=_super.call(this)||this;return _this.id="multiLine",_this.renderingMode="2d",_this.geoJSON={},_this.lineThickness=2,_this.pointColor=[13/255,64/255,140/255,1],_this.posMatrixCache={},Object.assign(_this,options),_this}return __extends(VectorTileLineLayer,_super),VectorTileLineLayer.prototype.getReglInitializationOptions=function(){var reglOptions={extensions:["OES_standard_derivatives"]};return reglOptions},VectorTileLineLayer.prototype.init=function(map,gl){this.tileIndex=geojson_vt_1.default(this.geoJSON,{maxZoom:24,tolerance:30,extent:8192});var _a=shader_module_1.getModule("line-vt"),vs=_a.vs,reglDrawConfig={frag:_a.fs,vert:vs,attributes:{a_color:{constant:this.pointColor},a_pos:this.regl.prop("a_pos"),a_line_miter:this.regl.prop("a_line_miter"),a_line_normal:this.regl.prop("a_line_normal"),a_counters:this.regl.prop("a_counters")},uniforms:{u_matrix:this.regl.prop("u_matrix"),u_thickness:this.regl.prop("u_thickness"),u_dash_array:.02,u_dash_offset:0,u_dash_ratio:0},primitive:"triangles",elements:this.regl.prop("indices"),blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:1}}};this.drawLines=this.regl(reglDrawConfig)},VectorTileLineLayer.prototype.renderTiles=function(){var _this=this;this.cleanPosMatrixCache();var currentZoomLevel=this.map.getZoom(),currentScale=web_mercator_1.zoomToScale(currentZoomLevel),flooredZoom=Math.floor(currentZoomLevel),bounds=this.map.getBounds(),tiles=tile_cover_1.default(flooredZoom,[mercator_coordinate_1.default.fromLngLat(bounds.getSouthWest()),mercator_coordinate_1.default.fromLngLat(bounds.getNorthEast()),mercator_coordinate_1.default.fromLngLat(bounds.getNorthWest()),mercator_coordinate_1.default.fromLngLat(bounds.getSouthEast())],flooredZoom,!1),stats=[];tiles.forEach(function(tile){var simplifiedNum=0;tile.posMatrix=_this.calculatePosMatrix(tile.toUnwrapped(),currentScale);var t=_this.tileIndex.getTile(tile.canonical.z,tile.canonical.x,tile.canonical.y);if(t&&t.features&&t.features.length){var attrNormal_1=[],attrMiter_1=[],attrIndex_1=[],attrPos_1=[],attrCounters_1=[],indexOffset_1=0;simplifiedNum+=t.numSimplified,t.features.forEach(function(feature){feature.geometry.forEach(function(points){var _a=polyline_normals_1.default(points,!1,indexOffset_1),normals=_a.normals,aIndex=_a.attrIndex,aPos=_a.attrPos,aCounters=_a.attrCounters;attrIndex_1=attrIndex_1.concat(aIndex),attrPos_1=attrPos_1.concat(aPos),attrCounters_1=attrCounters_1.concat(aCounters),indexOffset_1+=aPos.length,normals.forEach(function(n){var norm=n[0],miter=n[1];attrNormal_1.push([norm[0],norm[1]]),attrMiter_1.push(miter)})})});var drawParams={u_matrix:tile.posMatrix,u_thickness:_this.lineThickness,a_pos:_this.regl.buffer(attrPos_1),a_line_miter:_this.regl.buffer(attrMiter_1),a_line_normal:_this.regl.buffer(attrNormal_1),a_counters:_this.regl.buffer(attrCounters_1),indices:attrIndex_1};_this.drawLines(drawParams)}stats.push({tileID:tile.key,pointsNum:simplifiedNum})})},VectorTileLineLayer.prototype.frame=function(gl,m){this.renderTiles()},VectorTileLineLayer.prototype.calculatePosMatrix=function(unwrappedTileID,currentScale){var posMatrixKey=unwrappedTileID.key,cache=this.posMatrixCache;if(cache[posMatrixKey])return cache[posMatrixKey];var canonical=unwrappedTileID.canonical,scale=web_mercator_1.TILE_SIZE*currentScale/web_mercator_1.zoomToScale(canonical.z),unwrappedX=canonical.x+Math.pow(2,canonical.z)*unwrappedTileID.wrap,posMatrix=mat4.identity(new Float64Array(16));return mat4.translate(posMatrix,posMatrix,[unwrappedX*scale,canonical.y*scale,0]),mat4.scale(posMatrix,posMatrix,[scale/tile_id_1.EXTENT,scale/tile_id_1.EXTENT,1]),mat4.multiply(posMatrix,this.map.transform.projMatrix,posMatrix),cache[posMatrixKey]=new Float32Array(posMatrix),cache[posMatrixKey]},VectorTileLineLayer.prototype.cleanPosMatrixCache=function(){this.posMatrixCache={}},VectorTileLineLayer}(MapboxAdapterLayer_1.default);exports.default=VectorTileLineLayer},61:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var PI=Math.PI,PI_4=PI/4,DEGREES_TO_RADIANS=PI/180;exports.TILE_SIZE=512;var EARTH_CIRCUMFERENCE=4003e4;function zoomToScale(zoom){return Math.pow(2,zoom)}exports.zoomToScale=zoomToScale,exports.lngLatToWorld=function lngLatToWorld(_a,scale){var lng=_a[0],lat=_a[1];scale*=exports.TILE_SIZE;var phi2=lat*DEGREES_TO_RADIANS;return[scale*(lng*DEGREES_TO_RADIANS+PI)/(2*PI),scale*(PI-Math.log(Math.tan(PI_4+.5*phi2)))/(2*PI)]},exports.getDistanceScales=function getDistanceScales(options){var _a=options.latitude,latitude=void 0===_a?0:_a,_b=options.zoom,zoom=void 0===_b?1:_b,scale=options.scale,_c=options.highPrecision,highPrecision=void 0!==_c&&_c;scale=void 0!==scale?scale:zoomToScale(zoom);var result={},worldSize=exports.TILE_SIZE*scale,latCosine=Math.cos(latitude*DEGREES_TO_RADIANS),pixelsPerDegreeX=worldSize/360,pixelsPerDegreeY=pixelsPerDegreeX/latCosine,altPixelsPerMeter=worldSize/EARTH_CIRCUMFERENCE/latCosine;if(result.pixelsPerMeter=[altPixelsPerMeter,-altPixelsPerMeter,altPixelsPerMeter],result.metersPerPixel=[1/altPixelsPerMeter,-1/altPixelsPerMeter,1/altPixelsPerMeter],result.pixelsPerDegree=[pixelsPerDegreeX,-pixelsPerDegreeY,altPixelsPerMeter],result.degreesPerPixel=[1/pixelsPerDegreeX,-1/pixelsPerDegreeY,1/altPixelsPerMeter],highPrecision){var latCosine2=DEGREES_TO_RADIANS*Math.tan(latitude*DEGREES_TO_RADIANS)/latCosine,pixelsPerDegreeY2=pixelsPerDegreeX*latCosine2/2,altPixelsPerDegree2=worldSize/EARTH_CIRCUMFERENCE*latCosine2,altPixelsPerMeter2=altPixelsPerDegree2/pixelsPerDegreeY*altPixelsPerMeter;result.pixelsPerDegree2=[0,-pixelsPerDegreeY2,altPixelsPerDegree2],result.pixelsPerMeter2=[altPixelsPerMeter2,0,altPixelsPerMeter2]}return result}},637:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var mapboxgl=__webpack_require__(6),TriangleLayer=function(_super){function TriangleLayer(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.id="triangle",_this}return __extends(TriangleLayer,_super),TriangleLayer.prototype.getReglInitializationOptions=function(){return{}},TriangleLayer.prototype.init=function(map,gl){var helsinki=mapboxgl.MercatorCoordinate.fromLngLat({lng:25.004,lat:60.239}),berlin=mapboxgl.MercatorCoordinate.fromLngLat({lng:13.403,lat:52.562}),kyiv=mapboxgl.MercatorCoordinate.fromLngLat({lng:30.498,lat:50.541});this.drawTriangle=this.regl({frag:"\n                void main() {\n                    gl_FragColor = vec4(1.0, 0.0, 0.0, 0.5);\n                }\n            ",vert:"\n                uniform mat4 u_matrix;\n                attribute vec2 a_pos;\n                void main() {\n                    gl_Position = u_matrix * vec4(a_pos, 0.0, 1.0);\n                }\n            ",attributes:{a_pos:{buffer:this.regl.buffer([helsinki.x,helsinki.y,berlin.x,berlin.y,kyiv.x,kyiv.y]),offset:0,stride:0,normalized:!1}},uniforms:{u_matrix:this.regl.prop("u_matrix")},primitive:"triangle strip",offset:0,count:3,blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:1}}})},TriangleLayer.prototype.frame=function(gl,matrix){this.drawTriangle({u_matrix:matrix})},TriangleLayer}(__webpack_require__(31).default);exports.default=TriangleLayer},638:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var mat4=__webpack_require__(4),vec4=__webpack_require__(9),MapboxAdapterLayer_1=__webpack_require__(31),web_mercator_1=__webpack_require__(61),viewport_mercator_project_1=__webpack_require__(167),shader_module_1=__webpack_require__(38),polyline_normals_1=__webpack_require__(263),LineLayer=function(_super){function LineLayer(options){var _this=_super.call(this)||this;return _this.id="custom-line",_this.points=[],_this.lineThickness=2,_this.dashOffset=0,_this.dashArray=.02,_this.dashRatio=0,_this.pointColor=[13/255,64/255,140/255,1],_this.instance=!0,Object.assign(_this,options),_this}return __extends(LineLayer,_super),LineLayer.prototype.getReglInitializationOptions=function(){var reglOptions={};return this.instance&&(reglOptions.extensions=["ANGLE_instanced_arrays"]),reglOptions},LineLayer.prototype.init=function(map,gl){var points=this.points.reduce(function(prev,cur){return prev.push([Math.fround(Number(cur.lng)),Math.fround(Number(cur.lat))]),prev},[]),_a=polyline_normals_1.default(points,!1),normals=_a.normals,attrIndex=_a.attrIndex,attrPos=_a.attrPos,attrCounters=_a.attrCounters,attrNormal=[],attrMiter=[];normals.forEach(function(n){var norm=n[0],miter=n[1];attrNormal.push([norm[0],norm[1]]),attrMiter.push(miter)});var _b=shader_module_1.getModule("line"),vs=_b.vs,reglDrawConfig={frag:_b.fs,vert:vs,attributes:{a_color:{constant:this.pointColor},a_pos:{buffer:this.regl.buffer({data:attrPos})},a_line_miter:{buffer:this.regl.buffer({data:attrMiter})},a_line_normal:{buffer:this.regl.buffer({data:attrNormal})},a_counters:{buffer:this.regl.buffer({data:attrCounters})}},uniforms:{u_matrix:this.regl.prop("u_matrix"),u_thickness:this.regl.prop("u_thickness"),u_is_offset:this.regl.prop("u_is_offset"),u_pixels_per_degree:this.regl.prop("u_pixels_per_degree"),u_pixels_per_degree2:this.regl.prop("u_pixels_per_degree2"),u_pixels_per_meter:this.regl.prop("u_pixels_per_meter"),u_viewport_center:this.regl.prop("u_viewport_center"),u_project_scale:this.regl.prop("u_project_scale"),u_viewport_center_projection:this.regl.prop("u_viewport_center_projection"),u_dash_array:this.regl.prop("u_dash_array"),u_dash_offset:this.regl.prop("u_dash_offset"),u_dash_ratio:this.regl.prop("u_dash_ratio")},primitive:"triangles",elements:attrIndex,blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:1}}};this.drawPoints=this.regl(reglDrawConfig)},LineLayer.prototype.frame=function(gl,matrix){var currentZoomLevel=this.map.getZoom(),bearing=this.map.getBearing(),pitch=this.map.getPitch(),center=this.map.getCenter(),viewport=new viewport_mercator_project_1.default({width:gl.drawingBufferWidth/2,height:gl.drawingBufferHeight/2,longitude:center.lng,latitude:center.lat,zoom:currentZoomLevel,pitch:pitch,bearing:bearing}),viewProjectionMatrix=viewport.viewProjectionMatrix,projectionMatrix=viewport.projectionMatrix,viewMatrix=viewport.viewMatrix,viewMatrixUncentered=viewport.viewMatrixUncentered,_a=web_mercator_1.getDistanceScales({longitude:center.lng,latitude:center.lat,zoom:currentZoomLevel,highPrecision:!1}),pixelsPerDegree=_a.pixelsPerDegree,pixelsPerMeter=_a.pixelsPerMeter,drawParams={u_matrix:viewProjectionMatrix,u_thickness:this.lineThickness,u_is_offset:!1,u_pixels_per_degree:pixelsPerDegree&&pixelsPerDegree.map(function(p){return Math.fround(p)}),u_pixels_per_degree2:[0,0,0],u_viewport_center:[0,0],u_pixels_per_meter:pixelsPerMeter,u_project_scale:web_mercator_1.zoomToScale(currentZoomLevel),u_viewport_center_projection:[0,0,0,0],u_dash_array:this.dashArray,u_dash_offset:this.dashOffset,u_dash_ratio:this.dashRatio};if(currentZoomLevel>0){var _b=web_mercator_1.getDistanceScales({longitude:center.lng,latitude:center.lat,zoom:currentZoomLevel,highPrecision:!0}),pixelsPerDegree_1=_b.pixelsPerDegree,pixelsPerDegree2=_b.pixelsPerDegree2,pixelsPerMeter_1=_b.pixelsPerMeter,positionPixels=viewport.projectFlat([Math.fround(center.lng),Math.fround(center.lat)],Math.pow(2,currentZoomLevel)),projectionCenter=vec4.transformMat4([],[positionPixels[0],positionPixels[1],0,1],viewProjectionMatrix),viewMatrix2=viewMatrixUncentered||viewMatrix,viewProjectionMatrix2=mat4.multiply([],projectionMatrix,viewMatrix2);viewProjectionMatrix2=mat4.multiply([],viewProjectionMatrix2,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0]),drawParams.u_matrix=viewProjectionMatrix2,drawParams.u_is_offset=!0,drawParams.u_pixels_per_meter=pixelsPerMeter_1,drawParams.u_viewport_center=[Math.fround(center.lng),Math.fround(center.lat)],drawParams.u_viewport_center_projection=projectionCenter,drawParams.u_pixels_per_degree=pixelsPerDegree_1&&pixelsPerDegree_1.map(function(p){return Math.fround(p)}),drawParams.u_pixels_per_degree2=pixelsPerDegree2&&pixelsPerDegree2.map(function(p){return Math.fround(p)})}this.drawPoints(drawParams)},LineLayer}(MapboxAdapterLayer_1.default);exports.default=LineLayer},639:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var mat4=__webpack_require__(4),vec4=__webpack_require__(9),MapboxAdapterLayer_1=__webpack_require__(31),web_mercator_1=__webpack_require__(61),viewport_mercator_project_1=__webpack_require__(167),shader_module_1=__webpack_require__(38),Line3DLayer=function(_super){function Line3DLayer(options){var _this=_super.call(this)||this;return _this.id="line",_this.points=[],_this.lineThickness=5,_this.pointColor=[13/255,64/255,140/255,1],_this.instance=!0,_this.antialias=!1,_this.dashOffset=0,_this.dashArray=.02,_this.dashRatio=0,Object.assign(_this,options),_this}return __extends(Line3DLayer,_super),Line3DLayer.prototype.getReglInitializationOptions=function(){var reglOptions={};return this.instance&&(reglOptions.extensions=["ANGLE_instanced_arrays"]),reglOptions},Line3DLayer.prototype.init=function(map,gl){var points=this.points.reduce(function(prev,cur){return prev.push([Math.fround(Number(cur.lng)),Math.fround(Number(cur.lat))]),prev},[]),index=0,indexArray=[],attrPosition=[],directionAttributes=[],attrCounters=[];points.forEach(function(point,pointIndex,list){var i=index;pointIndex!==list.length-1&&(indexArray.push([i+0,i+1,i+2]),indexArray.push([i+2,i+1,i+3])),attrPosition.push([point[0],point[1],0]),attrPosition.push([point[0],point[1],0]),directionAttributes.push(-1,1),attrCounters.push(pointIndex/list.length,pointIndex/list.length),index+=2});var prevPosAttributes=[attrPosition[0],attrPosition[1]].concat(attrPosition).slice(0,-2),nextPosAttributes=attrPosition.concat([attrPosition[attrPosition.length-2],attrPosition[attrPosition.length-1]]).slice(2),_a=shader_module_1.getModule("line3d"),vs=_a.vs,reglDrawConfig={frag:_a.fs,vert:vs,attributes:{a_color:{constant:this.pointColor},a_pos:{buffer:this.regl.buffer({data:attrPosition})},a_prev:{buffer:this.regl.buffer({data:prevPosAttributes})},a_next:{buffer:this.regl.buffer({data:nextPosAttributes})},a_orientation:{buffer:this.regl.buffer({data:directionAttributes})},a_counters:{buffer:this.regl.buffer({data:attrCounters})}},uniforms:{u_matrix:this.regl.prop("u_matrix"),u_thickness:this.regl.prop("u_thickness"),u_is_offset:this.regl.prop("u_is_offset"),u_pixels_per_degree:this.regl.prop("u_pixels_per_degree"),u_pixels_per_degree2:this.regl.prop("u_pixels_per_degree2"),u_pixels_per_meter:this.regl.prop("u_pixels_per_meter"),u_viewport_center:this.regl.prop("u_viewport_center"),u_viewport_size:this.regl.prop("u_viewport_size"),u_project_scale:this.regl.prop("u_project_scale"),u_viewport_center_projection:this.regl.prop("u_viewport_center_projection"),u_antialias:this.regl.prop("u_antialias"),u_dash_array:this.regl.prop("u_dash_array"),u_dash_offset:this.regl.prop("u_dash_offset"),u_dash_ratio:this.regl.prop("u_dash_ratio")},primitive:"triangles",elements:indexArray,blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:1}}};this.drawPoints=this.regl(reglDrawConfig)},Line3DLayer.prototype.frame=function(gl,matrix){var currentZoomLevel=this.map.getZoom(),bearing=this.map.getBearing(),pitch=this.map.getPitch(),center=this.map.getCenter(),viewport=new viewport_mercator_project_1.default({width:gl.drawingBufferWidth/2,height:gl.drawingBufferHeight/2,longitude:center.lng,latitude:center.lat,zoom:currentZoomLevel,pitch:pitch,bearing:bearing}),width=viewport.width,height=viewport.height,viewProjectionMatrix=viewport.viewProjectionMatrix,projectionMatrix=viewport.projectionMatrix,viewMatrix=viewport.viewMatrix,viewMatrixUncentered=viewport.viewMatrixUncentered,devicePixelRatio=window.devicePixelRatio,viewportSize=[width*devicePixelRatio,height*devicePixelRatio],_a=web_mercator_1.getDistanceScales({longitude:center.lng,latitude:center.lat,zoom:currentZoomLevel,highPrecision:!1}),pixelsPerDegree=_a.pixelsPerDegree,pixelsPerMeter=_a.pixelsPerMeter,drawParams={u_matrix:viewProjectionMatrix,u_thickness:this.lineThickness,u_is_offset:!1,u_pixels_per_degree:pixelsPerDegree&&pixelsPerDegree.map(function(p){return Math.fround(p)}),u_pixels_per_degree2:[0,0,0],u_viewport_center:[0,0],u_viewport_size:viewportSize,u_pixels_per_meter:pixelsPerMeter,u_project_scale:web_mercator_1.zoomToScale(currentZoomLevel),u_viewport_center_projection:[0,0,0,0],u_antialias:this.antialias,u_dash_array:this.dashArray,u_dash_offset:this.dashOffset,u_dash_ratio:this.dashRatio};if(currentZoomLevel>0){var _b=web_mercator_1.getDistanceScales({longitude:center.lng,latitude:center.lat,zoom:currentZoomLevel,highPrecision:!0}),pixelsPerDegree_1=_b.pixelsPerDegree,pixelsPerDegree2=_b.pixelsPerDegree2,pixelsPerMeter_1=_b.pixelsPerMeter,positionPixels=viewport.projectFlat([Math.fround(center.lng),Math.fround(center.lat)],Math.pow(2,currentZoomLevel)),projectionCenter=vec4.transformMat4([],[positionPixels[0],positionPixels[1],0,1],viewProjectionMatrix),viewMatrix2=viewMatrixUncentered||viewMatrix,viewProjectionMatrix2=mat4.multiply([],projectionMatrix,viewMatrix2);viewProjectionMatrix2=mat4.multiply([],viewProjectionMatrix2,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0]),drawParams.u_matrix=viewProjectionMatrix2,drawParams.u_is_offset=!0,drawParams.u_pixels_per_meter=pixelsPerMeter_1,drawParams.u_viewport_center=[Math.fround(center.lng),Math.fround(center.lat)],drawParams.u_viewport_center_projection=projectionCenter,drawParams.u_pixels_per_degree=pixelsPerDegree_1&&pixelsPerDegree_1.map(function(p){return Math.fround(p)}),drawParams.u_pixels_per_degree2=pixelsPerDegree2&&pixelsPerDegree2.map(function(p){return Math.fround(p)})}this.drawPoints(drawParams)},Line3DLayer}(MapboxAdapterLayer_1.default);exports.default=Line3DLayer},640:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var MapboxAdapterLayer_1=__webpack_require__(31),shader_module_1=__webpack_require__(38),tile_id_1=__webpack_require__(68),glyph_manager_1=__webpack_require__(256),symbol_layout_1=__webpack_require__(258),GlyphAtlas_1=__webpack_require__(259),SymbolQuad_1=__webpack_require__(260),symbol_projection_1=__webpack_require__(163),CollisionIndex_1=__webpack_require__(262),Worker=__webpack_require__(641),TextLayer=function(_super){function TextLayer(options){var _this=_super.call(this)||this;return _this.id="text",_this.renderingMode="2d",_this.geoJSON={},_this.url="",_this.textField="name",_this.fontFamily="Monaco, monospace",_this.fontWeight=400,_this.fontSize=14,_this.fontColor=[0,0,0],_this.fontOpacity=1,_this.haloColor=[255,255,255],_this.haloWidth=1,_this.haloBlur=.2,_this.symbolAnchor="center",_this.textJustify="center",_this.textSpacing=2,_this.textOffsetX=0,_this.textOffsetY=0,_this.debug=!1,_this.tileIndexLoaded=!1,_this.tilesToRender=[],_this.handleWorkerMessage=function(_a){var data=_a.data,command=data.command,params=data.params;if("failure"!==data.status)switch(command){case"tileIndexLoaded":_this.tileIndexLoaded=!0;break;case"renderTiles":var tiles=params.tiles;_this.tilesToRender=tiles}else console.error(params)},Object.assign(_this,options),_this}return __extends(TextLayer,_super),TextLayer.prototype.getReglInitializationOptions=function(){var reglOptions={extensions:["ANGLE_instanced_arrays","OES_standard_derivatives"]};return reglOptions},TextLayer.prototype.init=function(map,gl){this.initDrawTextCommand(),this.initDrawDebugSDFCommand(),this.initGlyphAtlas(),this.initWorker()},TextLayer.prototype.initWorker=function(){this.worker=new Worker,this.worker.addEventListener("message",this.handleWorkerMessage),this.worker.postMessage({command:"loadData",params:{url:this.url,type:"geojson",isCluster:!1}})},TextLayer.prototype.initDrawTextCommand=function(){var _this=this,_a=shader_module_1.getModule("sdf"),vs=_a.vs,reglDrawConfig={frag:_a.fs,vert:vs,attributes:{a_pos:this.regl.prop("a_pos"),a_tex:this.regl.prop("a_tex"),a_offset:this.regl.prop("a_offset")},uniforms:{u_matrix:this.regl.prop("u_matrix"),u_label_matrix:this.regl.prop("u_label_matrix"),u_gl_matrix:this.regl.prop("u_gl_matrix"),u_sdf_map:this.regl.prop("u_sdf_map"),u_gamma_scale:Math.cos(this.map.transform._pitch),u_extrude_scale:this.map.transform.pixelsToGLUnits,u_sdf_map_size:this.regl.prop("u_sdf_map_size"),u_font_size:function(){return _this.fontSize},u_font_color:function(){return _this.fontColor.map(function(c){return c/255}).concat([1])},u_font_opacity:function(){return _this.fontOpacity},u_halo_width:function(){return _this.haloWidth},u_halo_blur:function(){return _this.haloBlur},u_halo_color:function(){return _this.haloColor.map(function(c){return c/255}).concat([1])},u_debug:function(){return _this.debug}},primitive:"triangles",elements:this.regl.prop("elements")};this.drawText=this.regl(reglDrawConfig)},TextLayer.prototype.initDrawDebugSDFCommand=function(){var _a=shader_module_1.getModule("quad"),vs=_a.vs,reglDrawConfig={frag:_a.fs,vert:vs,attributes:{a_extrude:[[-1,-1],[1,-1],[1,1],[-1,1]]},uniforms:{u_sdf_map:this.regl.prop("u_sdf_map")},primitive:"triangles",elements:[[0,1,2],[2,3,0]]};this.drawDebugSDF=this.regl(reglDrawConfig)},TextLayer.prototype.initGlyphAtlas=function(){var fontStack=this.fontFamily+" "+this.fontWeight;this.fontStack=fontStack;var glyphMap=glyph_manager_1.getDefaultCharacterSet().map(function(char){return glyph_manager_1.generateSDF(fontStack,char)}).reduce(function(prev,cur){return prev[cur.id]=cur,prev},{});this.glyphMap||(this.glyphMap={}),this.glyphMap[fontStack]=glyphMap,this.glyphAtlas=new GlyphAtlas_1.default(this.glyphMap),this.glyphAtlasTexture=this.regl.texture()},TextLayer.prototype.buildTextBuffers=function(textArray,posMatrix){var _this=this,charPositionBuffer=[],charUVBuffer=[],charOffsetBuffer=[],indexBuffer=[],textOffset=[this.textOffsetX,this.textOffsetY],textPixelRatio=symbol_projection_1.tileSize/tile_id_1.EXTENT,fontScale=this.fontSize/24,i=0;return textArray.forEach(function(_a){var text=_a.text,position=_a.position,shaping=symbol_layout_1.shapeText(text,_this.glyphMap,_this.fontStack,0,24,_this.symbolAnchor,_this.textJustify,_this.textSpacing,textOffset,1);if(shaping){var box=_this.collisionIndex.placeCollisionBox({x1:shaping.left*fontScale,x2:shaping.right*fontScale,y1:shaping.top*fontScale,y2:shaping.bottom*fontScale,anchorPointX:position[0],anchorPointY:position[1]},!1,textPixelRatio,posMatrix).box;if(box&&box.length)_this.collisionIndex.insertCollisionBox(box,0,0,0),SymbolQuad_1.getGlyphQuads(shaping,textOffset,!1,_this.glyphAtlas.positions).forEach(function(quad){charPositionBuffer.push(position),charPositionBuffer.push(position),charPositionBuffer.push(position),charPositionBuffer.push(position),charUVBuffer.push([quad.tex.x,quad.tex.y]),charUVBuffer.push([quad.tex.x+quad.tex.w,quad.tex.y]),charUVBuffer.push([quad.tex.x+quad.tex.w,quad.tex.y+quad.tex.h]),charUVBuffer.push([quad.tex.x,quad.tex.y+quad.tex.h]),charOffsetBuffer.push([quad.tl.x,quad.tl.y]),charOffsetBuffer.push([quad.tr.x,quad.tr.y]),charOffsetBuffer.push([quad.br.x,quad.br.y]),charOffsetBuffer.push([quad.bl.x,quad.bl.y]),indexBuffer.push([0+i,1+i,2+i]),indexBuffer.push([2+i,3+i,0+i]),i+=4})}}),{indexBuffer:indexBuffer,charPositionBuffer:charPositionBuffer,charUVBuffer:charUVBuffer,charOffsetBuffer:charOffsetBuffer}},TextLayer.prototype.renderText=function(textFeatures,posMatrix,overscaledZ){var _a=this.glyphAtlas.image,width=_a.width,height=_a.height,data=_a.data,s=symbol_projection_1.pixelsToTileUnits(overscaledZ,1,this.map.transform.zoom),labelPlaneMatrix=symbol_projection_1.getLabelPlaneMatrix(posMatrix,!1,!1,this.map.transform,s),glCoordMatrix=symbol_projection_1.getGlCoordMatrix(posMatrix,!1,!1,this.map.transform,s),_b=this.buildTextBuffers(textFeatures,posMatrix),textIndexes=_b.indexBuffer,charOffsetBuffer=_b.charOffsetBuffer,charPositionBuffer=_b.charPositionBuffer,charUVBuffer=_b.charUVBuffer;this.drawText({u_matrix:posMatrix,u_label_matrix:labelPlaneMatrix,u_gl_matrix:glCoordMatrix,a_pos:{buffer:this.regl.buffer(charPositionBuffer)},a_tex:{buffer:this.regl.buffer(charUVBuffer)},a_offset:{buffer:this.regl.buffer(charOffsetBuffer)},u_sdf_map:this.glyphAtlasTexture({width:width,height:height,mag:"linear",min:"linear",format:"alpha",data:data}),u_sdf_map_size:[width,height],elements:textIndexes})},TextLayer.prototype.renderTiles=function(){var _this=this;this.tilesToRender.forEach(function(tile){var textFeatures=tile.textFeatures,posMatrix=tile.posMatrix,overscaledZ=tile.overscaledZ;textFeatures&&textFeatures.length&&_this.renderText(textFeatures,posMatrix,overscaledZ)})},TextLayer.prototype.beforeRender=function(){var bounds=this.map.getBounds();this.worker.postMessage({command:"getTiles",params:{layer:"text",textField:this.textField,bounds:[bounds.getSouthWest(),bounds.getNorthEast(),bounds.getNorthWest(),bounds.getSouthEast()],zoom:this.map.getZoom(),projMatrix:this.map.transform.projMatrix}})},TextLayer.prototype.frame=function(gl,m){if(this.tileIndexLoaded&&(this.collisionIndex=new CollisionIndex_1.default(this.map.transform),this.renderTiles(),this.debug)){var _a=this.glyphAtlas.image,width=_a.width,height=_a.height,data=_a.data;this.drawDebugSDF({u_sdf_map:this.glyphAtlasTexture({width:width,height:height,mag:"linear",min:"linear",format:"alpha",flipY:!0,data:data})})}},TextLayer}(MapboxAdapterLayer_1.default);exports.default=TextLayer},641:function(module,exports,__webpack_require__){module.exports=function(){return new Worker(__webpack_require__.p+"d1499def4acb8a181455.worker.js")}},642:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)});Object.defineProperty(exports,"__esModule",{value:!0});var mat4=__webpack_require__(4),geojson_vt_1=__webpack_require__(276),MapboxAdapterLayer_1=__webpack_require__(31),shader_module_1=__webpack_require__(38),web_mercator_1=__webpack_require__(61),tile_cover_1=__webpack_require__(162),mercator_coordinate_1=__webpack_require__(117),tile_id_1=__webpack_require__(68),vertex_compression_1=__webpack_require__(261),CircleLayer=function(_super){function CircleLayer(options){var _this=_super.call(this)||this;return _this.id="circle",_this.renderingMode="2d",_this.geoJSON={},_this.pointShape="circle",_this.pointColor=[81,187,214],_this.pointRadius=10,_this.pointOpacity=1,_this.strokeWidth=2,_this.strokeColor=[255,255,255],_this.strokeOpacity=1,_this.posMatrixCache={},Object.assign(_this,options),_this}return __extends(CircleLayer,_super),CircleLayer.prototype.getReglInitializationOptions=function(){var reglOptions={extensions:["ANGLE_instanced_arrays","OES_standard_derivatives"]};return reglOptions},CircleLayer.prototype.init=function(map,gl){this.tileIndex=geojson_vt_1.default(this.geoJSON,{maxZoom:24,tolerance:30,extent:8192}),this.initDrawCircleCommand()},CircleLayer.prototype.initDrawCircleCommand=function(){var _a=shader_module_1.getModule("circle"),vs=_a.vs,reglDrawConfig={frag:_a.fs,vert:vs,attributes:{a_packed_data:this.regl.prop("a_packed_data"),a_packed_data2:this.regl.prop("a_packed_data2"),a_packed_data3:this.regl.prop("a_packed_data3")},uniforms:{u_matrix:this.regl.prop("u_matrix"),u_extrude_scale:this.map.transform.pixelsToGLUnits},primitive:"triangles",elements:this.regl.prop("elements"),cull:{enable:!1,face:"back"}};this.drawCircles=this.regl(reglDrawConfig)},CircleLayer.prototype.buildPointBuffers=function(clusters){var _this=this,packedBuffer=[],packedBuffer2=[],packedBuffer3=[],indexBuffer=[],i=0;return clusters.forEach(function(cluster,index){var _a=cluster.geometry[0],tileX=_a[0],tileY=_a[1],_b=vertex_compression_1.packCircleVertex({color:_this.pointColor.concat([255]),radius:_this.pointRadius,tileX:tileX,tileY:tileY,shape:_this.pointShape,opacity:_this.pointOpacity,strokeColor:_this.strokeColor.concat([255]),strokeOpacity:_this.strokeOpacity,strokeWidth:_this.strokeWidth}),packed1=_b.packedBuffer,packed2=_b.packedBuffer2,packed3=_b.packedBuffer3;packedBuffer.push.apply(packedBuffer,packed1),packedBuffer2.push.apply(packedBuffer2,packed2),packedBuffer3.push.apply(packedBuffer3,packed3),indexBuffer.push([0+i,1+i,2+i]),indexBuffer.push([2+i,3+i,0+i]),i+=4}),{packedBuffer:packedBuffer,packedBuffer2:packedBuffer2,packedBuffer3:packedBuffer3,indexBuffer:indexBuffer}},CircleLayer.prototype.renderPoints=function(clusters,posMatrix){var _a=this.buildPointBuffers(clusters),packedBuffer=_a.packedBuffer,packedBuffer2=_a.packedBuffer2,packedBuffer3=_a.packedBuffer3,indexBuffer=_a.indexBuffer;this.drawCircles({u_matrix:posMatrix,a_packed_data:{buffer:this.regl.buffer({usage:"dynamic",data:packedBuffer})},a_packed_data2:{buffer:this.regl.buffer({usage:"dynamic",data:packedBuffer2})},a_packed_data3:{buffer:this.regl.buffer({usage:"dynamic",data:packedBuffer3})},elements:indexBuffer})},CircleLayer.prototype.renderTiles=function(){var _this=this;this.cleanPosMatrixCache();var currentZoomLevel=this.map.getZoom(),currentScale=web_mercator_1.zoomToScale(currentZoomLevel),flooredZoom=Math.floor(currentZoomLevel),bounds=this.map.getBounds();tile_cover_1.default(flooredZoom,[mercator_coordinate_1.default.fromLngLat(bounds.getSouthWest()),mercator_coordinate_1.default.fromLngLat(bounds.getNorthEast()),mercator_coordinate_1.default.fromLngLat(bounds.getNorthWest()),mercator_coordinate_1.default.fromLngLat(bounds.getSouthEast())],flooredZoom,!1).forEach(function(tile){tile.posMatrix=_this.calculatePosMatrix(tile.toUnwrapped(),currentScale);var t=_this.tileIndex.getTile(tile.canonical.z,tile.canonical.x,tile.canonical.y);if(t&&t.features&&t.features.length){var points_1=[];t.features.forEach(function(feature){points_1.push({geometry:feature.geometry})}),_this.renderPoints(points_1,tile.posMatrix)}})},CircleLayer.prototype.frame=function(gl,m){this.renderTiles()},CircleLayer.prototype.calculatePosMatrix=function(unwrappedTileID,currentScale){var posMatrixKey=unwrappedTileID.key,cache=this.posMatrixCache;if(cache[posMatrixKey])return cache[posMatrixKey];var canonical=unwrappedTileID.canonical,scale=web_mercator_1.TILE_SIZE*currentScale/web_mercator_1.zoomToScale(canonical.z),unwrappedX=canonical.x+Math.pow(2,canonical.z)*unwrappedTileID.wrap,posMatrix=mat4.identity(new Float64Array(16));return mat4.translate(posMatrix,posMatrix,[unwrappedX*scale,canonical.y*scale,0]),mat4.scale(posMatrix,posMatrix,[scale/tile_id_1.EXTENT,scale/tile_id_1.EXTENT,1]),mat4.multiply(posMatrix,this.map.transform.projMatrix,posMatrix),cache[posMatrixKey]=new Float32Array(posMatrix),cache[posMatrixKey]},CircleLayer.prototype.cleanPosMatrixCache=function(){this.posMatrixCache={}},CircleLayer}(MapboxAdapterLayer_1.default);exports.default=CircleLayer},643:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var shader_module_1=__webpack_require__(38),common=__webpack_require__(644),project=__webpack_require__(645),point1VS=__webpack_require__(646),point1FS=__webpack_require__(647),point2VS=__webpack_require__(648),lineFS=__webpack_require__(649),lineVS=__webpack_require__(650),line3DFS=__webpack_require__(651),line3DVS=__webpack_require__(652),lineVTVS=__webpack_require__(653),circleFS=__webpack_require__(654),circleVS=__webpack_require__(655),sdfFS=__webpack_require__(656),sdfVS=__webpack_require__(657),quadFS=__webpack_require__(658),quadVS=__webpack_require__(659),sdf2D=__webpack_require__(660),decode=__webpack_require__(661);exports.compileBuiltinModules=function compileBuiltinModules(){shader_module_1.registerModule("point1",{vs:point1VS,fs:point1FS}),shader_module_1.registerModule("point2",{vs:point2VS,fs:point1FS}),shader_module_1.registerModule("common",{vs:common,fs:common}),shader_module_1.registerModule("project",{vs:project,fs:""}),shader_module_1.registerModule("line",{vs:lineVS,fs:lineFS}),shader_module_1.registerModule("line3d",{vs:line3DVS,fs:line3DFS}),shader_module_1.registerModule("line-vt",{vs:lineVTVS,fs:lineFS}),shader_module_1.registerModule("circle",{vs:circleVS,fs:circleFS}),shader_module_1.registerModule("sdf",{vs:sdfVS,fs:sdfFS}),shader_module_1.registerModule("sdf-2d",{vs:"",fs:sdf2D}),shader_module_1.registerModule("decode",{vs:decode,fs:""}),shader_module_1.registerModule("quad",{vs:quadVS,fs:quadFS})}},644:function(module,exports){module.exports="const float TILE_SIZE = 512.0;\nconst float PI = 3.1415926536;\nconst float WORLD_SCALE = TILE_SIZE / (PI * 2.0);"},645:function(module,exports){module.exports='uniform float u_project_scale;\nuniform bool u_is_offset;\nuniform vec3 u_pixels_per_degree;\nuniform vec3 u_pixels_per_degree2;\nuniform vec3 u_pixels_per_meter;\nuniform vec2 u_viewport_center;\nuniform vec4 u_viewport_center_projection;\nuniform vec2 u_viewport_size;\n\n#pragma include "common"\n\nfloat project_scale(float meters) {\n    return meters * u_pixels_per_meter.z;\n}\n\nvec3 project_scale(vec3 position) {\n    return position * u_pixels_per_meter;\n}\n\nvec2 project_mercator(vec2 lnglat) {\n  float x = lnglat.x;\n  return vec2(\n    radians(x) + PI,\n    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))\n  );\n}\n\nvec4 project_offset(vec4 offset) {\n    float dy = offset.y;\n    dy = clamp(dy, -1., 1.);\n    vec3 pixels_per_unit = u_pixels_per_degree + u_pixels_per_degree2 * dy;\n    return vec4(offset.xyz * pixels_per_unit, offset.w);\n}\n\nvec4 project_position(vec4 position) {\n    if (u_is_offset) {\n        float X = position.x - u_viewport_center.x;\n        float Y = position.y - u_viewport_center.y;\n        return project_offset(vec4(X, Y, position.z, position.w));\n    } else {\n        return vec4(\n            project_mercator(position.xy) * WORLD_SCALE * u_project_scale,\n            project_scale(position.z),\n            position.w\n        );\n    }\n}\n\nvec4 project_to_clipping_space(vec3 position) {\n    vec4 project_pos = project_position(vec4(position, 1.0));\n    return u_matrix * project_pos + u_viewport_center_projection;\n}'},646:function(module,exports){module.exports='attribute vec2 a_pos;\nattribute vec4 a_color;\n\nuniform mat4 u_matrix;\nuniform float u_point_size;\n\nvarying vec4 v_color;\n\n#pragma include "common"\n\nvoid main() {\n    v_color = a_color;\n    gl_PointSize = u_point_size;\n    gl_Position = u_matrix * vec4(a_pos, 0.0, 1.0);\n}'},647:function(module,exports){module.exports='#extension GL_OES_standard_derivatives : enable\n\nuniform bool u_is_circle;\nvarying vec4 v_color;\n\n#pragma include "common"\n\nvoid main() {\n    float r = 0.0, delta = 0.0, alpha = 1.0;\n    if (u_is_circle) {\n        vec2 cxy = 2.0 * gl_PointCoord - 1.0;\n        r = dot(cxy, cxy);\n\n        delta = fwidth(r);\n        alpha = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);\n\n    }\n    gl_FragColor = v_color * alpha;\n}'},648:function(module,exports){module.exports='attribute vec2 a_pos;\nattribute vec4 a_color;\n\nuniform mat4 u_matrix;\nuniform float u_point_size;\nvarying vec4 v_color;\n\n#pragma include "common"\n#pragma include "project"\n\nvoid main() {\n    v_color = a_color;\n    gl_PointSize = u_point_size;\n\n    vec4 project_pos = project_position(vec4(a_pos, 0.0, 1.0));\n    gl_Position = u_matrix * project_pos + u_viewport_center_projection;\n}'},649:function(module,exports){module.exports="uniform float u_dash_array;\nuniform float u_dash_offset;\nuniform float u_dash_ratio;\nuniform float u_thickness;\n\nvarying vec4 v_color;\nvarying vec2 v_normal;\nvarying float v_counters;\n\nvoid main() {\n    float blur = 1. - smoothstep(0.98, 1., length(v_normal));\n\n    gl_FragColor = v_color;\n    gl_FragColor.a *= blur * ceil(mod(v_counters + u_dash_offset, u_dash_array) - (u_dash_array * u_dash_ratio));\n}"},650:function(module,exports){module.exports='attribute vec2 a_pos;\nattribute vec4 a_color;\nattribute float a_line_miter;\nattribute vec2 a_line_normal;\nattribute float a_counters;\n\nuniform mat4 u_matrix;\nuniform float u_thickness;\n\nvarying vec4 v_color;\nvarying vec2 v_normal;\nvarying float v_counters;\n\n#pragma include "common"\n#pragma include "project"\n\nvoid main() {\n    v_color = a_color;\n    v_counters = a_counters;\n\n    vec3 normal = normalize(vec3(a_line_normal, 0.0) * u_pixels_per_degree);\n\n    vec4 offset = vec4(normal * u_thickness / 2.0 * a_line_miter, 0.0);\n\n    v_normal = vec2(normal * sign(a_line_miter));\n\n    vec4 project_pos = project_position(vec4(a_pos, 0.0, 1.0));\n    gl_Position = u_matrix * (project_pos + offset) + u_viewport_center_projection;\n}\n'},651:function(module,exports){module.exports="uniform float u_dash_array;\nuniform float u_dash_offset;\nuniform float u_dash_ratio;\nuniform float u_thickness;\nuniform bool u_antialias;\n\nvarying vec4 v_color;\nvarying vec2 v_normal;\nvarying float v_counters;\n\nvoid main() {\n    float blur = 1.;\n    if (u_antialias) {\n        blur = 1. - smoothstep(0.98, 1., length(v_normal));\n    }\n\n    gl_FragColor = v_color;\n    gl_FragColor.a *= blur * ceil(mod(v_counters + u_dash_offset, u_dash_array) - (u_dash_array * u_dash_ratio));\n}"},652:function(module,exports){module.exports='attribute vec3 a_pos;\nattribute vec3 a_next;\nattribute vec3 a_prev;\nattribute float a_orientation;\nattribute float a_counters;\n\nattribute vec4 a_color;\n\nuniform mat4 u_matrix;\nuniform float u_thickness;\nvarying vec4 v_color;\nvarying vec2 v_normal;\nvarying float v_counters;\n\n#pragma include "common"\n#pragma include "project"\n\nvec2 project_to_screenspace(vec4 position, float aspect) {\n\treturn position.xy / position.w * aspect;\n}\n\nvoid main() {\n    v_color = a_color;\n    v_counters = a_counters;\n\n    // 宽高比\n    float aspect = u_viewport_size.x / u_viewport_size.y;\n\n    // 先投影到裁剪空间\n    vec4 projected_current = project_to_clipping_space(a_pos);\n    vec2 currentP = project_to_screenspace(projected_current, aspect);\n    // v_pos = currentP;\n    vec2 prevP = project_to_screenspace(project_to_clipping_space(a_prev), aspect);\n    vec2 nextP = project_to_screenspace(project_to_clipping_space(a_next), aspect);\n\n    vec2 dir = vec2(0.0);\n    vec2 n = vec2(0.0);\n    float len = u_thickness;\n    if (currentP == prevP) {\n        dir = normalize(nextP - currentP);\n        n = vec2(-dir.y, dir.x);\n        // currentP = nextP;\n    } else if (currentP == nextP) {\n        dir = normalize(currentP - prevP);\n        n = vec2(-dir.y, dir.x);\n    } else {\n        // 计算切线和 miter\n        vec2 dir1 = normalize(currentP - prevP);\n        vec2 dir2 = normalize(nextP - currentP);\n        vec2 tangent = normalize(dir1 + dir2);\n        vec2 perp = vec2(-dir1.y, dir1.x);\n        vec2 miter = vec2(-tangent.y, tangent.x);\n\n        // 投影到 miter 方向\n        len = u_thickness / dot(miter, perp);\n        dir = tangent;\n\n        n = vec2(-dir1.y, dir1.x);\n    }\n\n    vec2 normal = vec2(-dir.y, dir.x);\n    v_normal = n * a_orientation;\n\n    normal *= len / 2.0 / 100.;\n    normal.x /= aspect;\n\n    // 得到最终偏移量\n    vec4 offset = vec4(normal * a_orientation, 0.0, 0.0);\n    gl_Position = projected_current + offset;\n}\n'},653:function(module,exports){module.exports='attribute vec2 a_pos;\nattribute vec4 a_color;\nattribute float a_line_miter;\nattribute vec2 a_line_normal;\nattribute float a_counters;\n\nuniform mat4 u_matrix;\nuniform float u_thickness;\n\nvarying vec4 v_color;\nvarying vec2 v_normal;\nvarying float v_counters;\n\n#pragma include "common"\n\nvoid main() {\n    v_color = a_color;\n    v_counters = a_counters;\n\n    // vec3 normal = normalize(vec3(a_line_normal, 0.0) * u_pixels_per_degree);\n    vec3 normal = normalize(vec3(a_line_normal, 0.0));\n\n    vec4 offset = vec4(normal * u_thickness * 4. / 2.0 * a_line_miter, 0.0);\n\n    v_normal = vec2(normal * sign(a_line_miter));\n\n    gl_Position = u_matrix * (vec4(a_pos, 0.0, 1.0) + offset);\n}\n'},654:function(module,exports){module.exports="varying vec4 v_data;\nvarying vec4 v_data2;\nvarying vec4 v_color;\nvarying vec4 v_stroke_color;\n\n#pragma include \"sdf-2d\"\n\nvoid main() {\n\n    vec2 extrude = v_data.xy;\n    lowp float antialiasblur = v_data.z;\n    int shape = int(floor(v_data.w + 0.5));\n\n    float radius = v_data2.x;\n    float opacity = v_data2.y;\n    float stroke_width = v_data2.z;\n    float stroke_opacity = v_data2.w;\n\n    float r = radius / (radius + stroke_width);\n\n    float outer_df;\n    float inner_df;\n    // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'\n    if (shape == 0) {\n        outer_df = sdCircle(extrude, 1.0);\n        inner_df = sdCircle(extrude, r);\n    } else if (shape == 1) {\n        outer_df = sdEquilateralTriangle(1.1 * extrude);\n        inner_df = sdEquilateralTriangle(1.1 / r * extrude);\n    } else if (shape == 2) {\n        outer_df = sdBox(extrude, vec2(1.));\n        inner_df = sdBox(extrude, vec2(r));\n    } else if (shape == 3) {\n        outer_df = sdPentagon(extrude, 0.8);\n        inner_df = sdPentagon(extrude, r * 0.8);\n    } else if (shape == 4) {\n        outer_df = sdHexagon(extrude, 0.8);\n        inner_df = sdHexagon(extrude, r * 0.8);\n    } else if (shape == 5) {\n        outer_df = sdOctogon(extrude, 1.0);\n        inner_df = sdOctogon(extrude, r);\n    } else if (shape == 6) {\n        outer_df = sdHexagram(extrude, 0.52);\n        inner_df = sdHexagram(extrude, r * 0.52);\n    } else if (shape == 7) {\n        outer_df = sdRhombus(extrude, vec2(1.0));\n        inner_df = sdRhombus(extrude, vec2(r));\n    } else if (shape == 8) {\n        outer_df = sdVesica(extrude, 1.1, 0.8);\n        inner_df = sdVesica(extrude, r * 1.1, r * 0.8);\n    }\n    \n    float blur = 0.;\n    float antialiased_blur = -max(blur, antialiasblur);\n\n    float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);\n\n    float color_t = stroke_width < 0.01 ? 0.0 : smoothstep(\n        antialiased_blur,\n        0.0,\n        inner_df\n    );\n\n    gl_FragColor = opacity_t * mix(v_color * opacity, v_stroke_color * stroke_opacity, color_t);\n}"},655:function(module,exports){module.exports='attribute vec4 a_packed_data;\nattribute vec4 a_packed_data2;\nattribute vec4 a_packed_data3;\n\nuniform mat4 u_matrix;\nuniform vec2 u_extrude_scale;\n\nvarying vec4 v_color;\nvarying vec4 v_stroke_color;\nvarying vec4 v_data;\nvarying vec4 v_data2;\n\n#pragma include "common"\n#pragma include "decode"\n#define DEVICE_PIXEL_RATIO 1.0\n\nvoid main() {\n    // unpack color(vec2)\n    v_color = decode_color(a_packed_data.xy);\n    v_stroke_color = decode_color(a_packed_data2.xy);\n\n    // unpack tileX & tileY\n    float compressed = a_packed_data.w;\n    vec2 pos_in_tile;\n    pos_in_tile.x = floor(compressed * SHIFT_RIGHT19);\n    compressed -= pos_in_tile.x * SHIFT_LEFT19;\n    pos_in_tile.x = pos_in_tile.x - 512.;\n    pos_in_tile.y = floor(compressed * SHIFT_RIGHT6);\n    compressed -= pos_in_tile.y * SHIFT_LEFT6;\n    pos_in_tile.y = pos_in_tile.y - 512.;\n\n    // unpack data(extrude(4-bit), radius(16-bit))\n    compressed = a_packed_data.z;\n\n    // extrude(4-bit)\n    vec2 extrude;\n    extrude.x = floor(compressed * SHIFT_RIGHT23);\n    compressed -= extrude.x * SHIFT_LEFT23;\n    extrude.x = extrude.x - 1.;\n\n    extrude.y = floor(compressed * SHIFT_RIGHT21);\n    compressed -= extrude.y * SHIFT_LEFT21;\n    extrude.y = extrude.y - 1.;\n\n    float shape_type = floor(compressed * SHIFT_RIGHT17);\n    compressed -= shape_type * SHIFT_LEFT17;\n\n    // radius(16-bit)\n    float radius = compressed;\n\n    float stroke_width = a_packed_data2.z;\n    float stroke_opacity = a_packed_data2.w;\n    float opacity = a_packed_data3.x;\n\n    gl_Position = u_matrix * vec4(pos_in_tile, 0.0, 1.0);\n    gl_Position.xy += extrude * (radius + stroke_width) * u_extrude_scale * gl_Position.w;\n\n    float antialiasblur = 1.0 / DEVICE_PIXEL_RATIO / (radius + stroke_width);\n\n    v_data = vec4(extrude, antialiasblur, shape_type);\n    v_data2 = vec4(radius, opacity, stroke_width, stroke_opacity);\n}'},656:function(module,exports){module.exports="#define SDF_PX 8.0\n#define DEVICE_PIXEL_RATIO 2.0\n#define EDGE_GAMMA 0.105 / DEVICE_PIXEL_RATIO\n\nuniform sampler2D u_sdf_map;\nuniform float u_gamma_scale;\nuniform vec4 u_font_color;\nuniform float u_font_size;\nuniform float u_font_opacity;\nuniform vec4 u_halo_color;\nuniform float u_halo_width;\nuniform float u_halo_blur;\nuniform bool u_debug;\n\nvarying vec2 v_uv;\nvarying float v_gamma_scale;\n\nvoid main() {\n    // get sdf from atlas\n    float dist = texture2D(u_sdf_map, v_uv).a;\n\n    float fontScale = u_font_size / 24.0;\n    // lowp float buff = (256.0 - 64.0) / 256.0;\n    // highp float gamma = EDGE_GAMMA / (fontScale * u_gamma_scale);\n\n    lowp float buff = (6.0 - u_halo_width / fontScale) / SDF_PX;\n    highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (fontScale * u_gamma_scale);\n    \n    highp float gamma_scaled = gamma * v_gamma_scale;\n\n    highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\n\n    gl_FragColor = mix(u_font_color * u_font_opacity, u_halo_color, smoothstep(0., .5, 1. - dist)) * alpha;\n\n    if (u_debug) {\n        vec4 debug_color = vec4(1., 0., 0., 1.);\n        gl_FragColor = mix(gl_FragColor, debug_color, 0.5);\n    }\n}"},657:function(module,exports){module.exports="attribute vec2 a_pos;\nattribute vec2 a_tex;\nattribute vec2 a_offset;\n\nuniform vec2 u_sdf_map_size;\nuniform mat4 u_label_matrix;\nuniform mat4 u_gl_matrix;\nuniform float u_font_size;\n\nvarying vec2 v_uv;\nvarying float v_gamma_scale;\n\nvoid main() {\n    v_uv = a_tex / u_sdf_map_size;\n\n    float fontScale = u_font_size / 24.;\n\n    vec4 projected_pos = u_label_matrix * vec4(a_pos, 0.0, 1.0);\n    gl_Position = u_gl_matrix * vec4(projected_pos.xy / projected_pos.w + a_offset * fontScale, 0.0, 1.0);\n\n    v_gamma_scale = gl_Position.w;\n}"},658:function(module,exports){module.exports="uniform sampler2D u_sdf_map;\nvarying vec2 v_uv;\n\nvoid main() {\n    gl_FragColor = texture2D(u_sdf_map, v_uv);\n}"},659:function(module,exports){module.exports="attribute vec2 a_extrude;\n\nuniform mat4 u_matrix;\nuniform vec2 u_sdf_map_size;\n\nvarying vec2 v_uv;\n\nvoid main() {\n    v_uv = a_extrude * 0.5 + 0.5;\n    // gl_Position = u_matrix * vec4(a_pos, 0.0, 1.0);\n    gl_Position = vec4(-0.8, -.6, 0.0, 1.0);\n    gl_Position.xy += a_extrude * vec2(0.1, 0.2);\n}"},660:function(module,exports){module.exports="/**\n * 2D signed distance field functions\n * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm\n */\n\nfloat ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }\n\nfloat sdCircle(vec2 p, float r) {\n  return length(p) - r;\n}\n\nfloat sdEquilateralTriangle(vec2 p) {\n  const float k = sqrt(3.0);\n  p.x = abs(p.x) - 1.0;\n  p.y = p.y + 1.0/k;\n  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;\n  p.x -= clamp( p.x, -2.0, 0.0 );\n  return -length(p)*sign(p.y);\n}\n\nfloat sdBox(vec2 p, vec2 b) {\n  vec2 d = abs(p)-b;\n  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);\n}\n\nfloat sdPentagon(vec2 p, float r) {\n  const vec3 k = vec3(0.809016994,0.587785252,0.726542528);\n  p.x = abs(p.x);\n  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\n  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\n  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);    \n  return length(p)*sign(p.y);\n}\n\nfloat sdHexagon(vec2 p, float r) {\n  const vec3 k = vec3(-0.866025404,0.5,0.577350269);\n  p = abs(p);\n  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\n  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdOctogon(vec2 p, float r) {\n  const vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );\n  p = abs(p);\n  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\n  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\n  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdHexagram(vec2 p, float r) {\n  const vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);\n  p = abs(p);\n  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\n  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;\n  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdRhombus(vec2 p, vec2 b) {\n  vec2 q = abs(p);\n  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);\n  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );\n  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );\n}\n\nfloat sdVesica(vec2 p, float r, float d) {\n  p = abs(p);\n  float b = sqrt(r*r-d*d); // can delay this sqrt\n  return ((p.y-b)*d>p.x*b) \n          ? length(p-vec2(0.0,b))\n          : length(p-vec2(-d,0.0))-r;\n}"},661:function(module,exports){module.exports="#define SHIFT_RIGHT1 0.5\n#define SHIFT_RIGHT2 0.25\n#define SHIFT_RIGHT4 1.0 / 16.0\n#define SHIFT_RIGHT6 1.0 / 64.0\n#define SHIFT_RIGHT7 1.0 / 128.0\n#define SHIFT_RIGHT13 1.0 / 8192.0\n#define SHIFT_RIGHT14 1.0 / 16384.0\n#define SHIFT_RIGHT15 1.0 / 32768.0\n#define SHIFT_RIGHT16 1.0 / 65536.0\n#define SHIFT_RIGHT17 1.0 / 131072.0\n#define SHIFT_RIGHT18 1.0 / 262144.0\n#define SHIFT_RIGHT19 1.0 / 524288.0\n#define SHIFT_RIGHT20 1.0 / 1048576.0\n#define SHIFT_RIGHT21 1.0 / 2097152.0\n#define SHIFT_RIGHT22 1.0 / 4194304.0\n#define SHIFT_RIGHT23 1.0 / 8388608.0\n#define SHIFT_RIGHT24 1.0 / 16777216.0\n\n#define SHIFT_LEFT1 2.0\n#define SHIFT_LEFT2 4.0\n#define SHIFT_LEFT4 16.0\n#define SHIFT_LEFT6 64.0\n#define SHIFT_LEFT7 128.0\n#define SHIFT_LEFT13 8192.0\n#define SHIFT_LEFT14 16384.0\n#define SHIFT_LEFT15 32768.0\n#define SHIFT_LEFT16 65536.0\n#define SHIFT_LEFT17 131072.0\n#define SHIFT_LEFT18 262144.0\n#define SHIFT_LEFT19 524288.0\n#define SHIFT_LEFT20 1048576.0\n#define SHIFT_LEFT21 2097152.0\n#define SHIFT_LEFT22 4194304.0\n#define SHIFT_LEFT23 8388608.0\n#define SHIFT_LEFT24 16777216.0\n\nvec2 unpack_float(const float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\n\nvec4 decode_color(const vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\n\nvec2 unpack_opacity(const float packedOpacity) {\n  int intOpacity = int(packedOpacity) / 2;\n  return vec2(float(intOpacity) / 127.0, mod(packedOpacity, 2.0));\n}"},662:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_exports__.default="绘制 2D 直线，可以参考我在知乎上写的文章：[在 WebGL 中绘制直线](https://zhuanlan.zhihu.com/p/59541559)，包含以下特性：\n\n* 沿法向拉伸\n* 锐角 miter 接头转换成 bevel 接头\n\n"},663:function(module,exports,__webpack_require__){"use strict";(function(module){Object.defineProperty(exports,"__esModule",{value:!0});var React=__webpack_require__(1),react_1=__webpack_require__(81),PointLayerBad_md_1=__webpack_require__(664),PointLayer_md_1=__webpack_require__(665),Point2DSDF_md_1=__webpack_require__(666),PointLayerBad_1=__webpack_require__(667),PointLayer_1=__webpack_require__(668),CircleLayer_1=__webpack_require__(669);react_1.storiesOf("PointLayer",module).add("精度问题",function(){return React.createElement(PointLayerBad_1.default,null)},{notes:{markdown:PointLayerBad_md_1.default}}).add("偏移坐标系",function(){return React.createElement(PointLayer_1.default,null)},{notes:{markdown:PointLayer_md_1.default}}).add("2D SDF",function(){return React.createElement(CircleLayer_1.default,null)},{notes:{markdown:Point2DSDF_md_1.default}})}).call(this,__webpack_require__(30)(module))},664:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_exports__.default="高缩放等级下精度问题导致“抖动”现象。\n详见：[解决高缩放等级下的抖动问题](https://zhuanlan.zhihu.com/p/57469121)"},665:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_exports__.default="参考 Deck.gl 使用偏移坐标系，详见：[解决高缩放等级下的抖动问题](https://zhuanlan.zhihu.com/p/57469121)"},666:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_exports__.default="使用 2D SDF 函数绘制点要素。\n\n* 距离场特性决定了描边、边缘反走样、内外阴影效果容易高效实现，完全不需要额外 Pass 绘制边缘\n* 每个图形顶点数目始终为 4，完全不需要 CPU 计算正多边形顶点\n* 完全可以使用一组通用的 Vertex/Fragment shader 实现全部种类图形的绘制，例如正六边形、正八边形、三角形、菱形、五角星、椭圆甚至是贝塞尔曲线\n\n[完整 2D SDF 函数](http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm)"},667:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}};Object.defineProperty(exports,"__esModule",{value:!0});var React=__webpack_require__(1),react_mapbox_gl_1=__webpack_require__(51),dat=__webpack_require__(49),d3_dsv_1=__webpack_require__(277),src_1=__webpack_require__(50),Map=react_mapbox_gl_1.default({accessToken:"pk.eyJ1IjoieGlhb2l2ZXIiLCJhIjoiY2pxcmc5OGNkMDY3cjQzbG42cXk5NTl3YiJ9.hUC5Chlqzzh0FFd_aEc-uQ"}),PointLayerBad=function(_super){function PointLayerBad(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(PointLayerBad,_super),PointLayerBad.prototype.componentWillUnmount=function(){this.gui&&this.gui.destroy()},PointLayerBad.prototype.render=function(){var _this=this;return React.createElement(Map,{style:"mapbox://styles/mapbox/light-v9",center:[121.49851,31.289317],zoom:[15],containerStyle:{height:"100vh",width:"100vw"},onStyleLoad:function(map){return __awaiter(_this,void 0,void 0,function(){var rawCSVData,points,layer_1,gui,pointFolder,layers,labelLayerId,i;return __generator(this,function(_a){switch(_a.label){case 0:return map?[4,fetch("https://gw.alipayobjects.com/os/rmsportal/BElVQFEFvpAKzddxFZxJ.txt")]:[3,3];case 1:return[4,_a.sent().text()];case 2:if(rawCSVData=_a.sent(),points=d3_dsv_1.csvParse(rawCSVData),layer_1=new src_1.PointCloudLayer({instance:!0,points:points}),gui=new dat.GUI,this.gui=gui,(pointFolder=gui.addFolder("point")).add(layer_1,"pointSize",1,200).onChange(function(){layer_1.triggerRepaint()}),pointFolder.add(layer_1,"isCircle").onChange(function(){layer_1.triggerRepaint()}),(layers=map.getStyle().layers)&&layers.length){for(labelLayerId=void 0,i=0;i<layers.length;i++)if(layers[i]&&"symbol"===layers[i].type&&layers[i].layout["text-field"]){labelLayerId=layers[i].id;break}map.addLayer(layer_1,labelLayerId)}_a.label=3;case 3:return[2]}})})}})},PointLayerBad}(React.Component);exports.default=PointLayerBad},668:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}};Object.defineProperty(exports,"__esModule",{value:!0});var React=__webpack_require__(1),react_mapbox_gl_1=__webpack_require__(51),dat=__webpack_require__(49),d3_dsv_1=__webpack_require__(277),src_1=__webpack_require__(50),Map=react_mapbox_gl_1.default({accessToken:"pk.eyJ1IjoieGlhb2l2ZXIiLCJhIjoiY2pxcmc5OGNkMDY3cjQzbG42cXk5NTl3YiJ9.hUC5Chlqzzh0FFd_aEc-uQ"}),PointLayer=function(_super){function PointLayer(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(PointLayer,_super),PointLayer.prototype.componentWillUnmount=function(){this.gui&&this.gui.destroy()},PointLayer.prototype.render=function(){var _this=this;return React.createElement(Map,{style:"mapbox://styles/mapbox/light-v9",center:[121.49851,31.289317],zoom:[15],containerStyle:{height:"100vh",width:"100vw"},onStyleLoad:function(map){return __awaiter(_this,void 0,void 0,function(){var rawCSVData,points,layer_1,gui,pointFolder,layers,labelLayerId,i;return __generator(this,function(_a){switch(_a.label){case 0:return map?[4,fetch("https://gw.alipayobjects.com/os/rmsportal/BElVQFEFvpAKzddxFZxJ.txt")]:[3,3];case 1:return[4,_a.sent().text()];case 2:if(rawCSVData=_a.sent(),points=d3_dsv_1.csvParse(rawCSVData),layer_1=new src_1.PointCloudLayer2({instance:!0,points:points}),gui=new dat.GUI,this.gui=gui,(pointFolder=gui.addFolder("point")).add(layer_1,"pointSize",1,200).onChange(function(){layer_1.triggerRepaint()}),pointFolder.add(layer_1,"isCircle").onChange(function(){layer_1.triggerRepaint()}),(layers=map.getStyle().layers)&&layers.length){for(labelLayerId=void 0,i=0;i<layers.length;i++)if(layers[i]&&"symbol"===layers[i].type&&layers[i].layout["text-field"]){labelLayerId=layers[i].id;break}map.addLayer(layer_1,labelLayerId)}_a.label=3;case 3:return[2]}})})}})},PointLayer}(React.Component);exports.default=PointLayer},669:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}};Object.defineProperty(exports,"__esModule",{value:!0});var React=__webpack_require__(1),react_mapbox_gl_1=__webpack_require__(51),dat=__webpack_require__(49),src_1=__webpack_require__(50),sdf_2d_1=__webpack_require__(164),Map=react_mapbox_gl_1.default({accessToken:"pk.eyJ1IjoieGlhb2l2ZXIiLCJhIjoiY2pxcmc5OGNkMDY3cjQzbG42cXk5NTl3YiJ9.hUC5Chlqzzh0FFd_aEc-uQ"}),CircleLayerDemo=function(_super){function CircleLayerDemo(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(CircleLayerDemo,_super),CircleLayerDemo.prototype.componentWillUnmount=function(){this.gui&&this.gui.destroy(),this.$stats&&document.body.removeChild(this.$stats)},CircleLayerDemo.prototype.render=function(){var _this=this;return React.createElement(React.Fragment,null,React.createElement("div",{id:"stats"}),React.createElement(Map,{style:"mapbox://styles/mapbox/light-v9",center:[-95.96471106679122,28.604925848431535],zoom:[0],containerStyle:{height:"100vh",width:"100vw"},onStyleLoad:function(map){return __awaiter(_this,void 0,void 0,function(){var response,layer_1,_a,_b,gui,pointFolder,layers,labelLayerId,i;return __generator(this,function(_c){switch(_c.label){case 0:return map?[4,fetch("https://d2ad6b4ur7yvpq.cloudfront.net/naturalearth-3.3.0/ne_10m_geography_regions_points.geojson")]:[3,3];case 1:return response=_c.sent(),_a=src_1.CircleLayer.bind,_b={},[4,response.json()];case 2:if(layer_1=new(_a.apply(src_1.CircleLayer,[void 0,(_b.geoJSON=_c.sent(),_b)])),gui=new dat.GUI,this.gui=gui,(pointFolder=gui.addFolder("leaf point")).add(layer_1,"pointShape",sdf_2d_1.sdf2DFunctions).onChange(function(){layer_1.triggerRepaint()}),pointFolder.addColor(layer_1,"pointColor").onChange(function(){layer_1.triggerRepaint()}),pointFolder.add(layer_1,"pointRadius",2,20).onChange(function(){layer_1.triggerRepaint()}),pointFolder.add(layer_1,"pointOpacity",0,1,.1).onChange(function(){layer_1.triggerRepaint()}),pointFolder.addColor(layer_1,"strokeColor").onChange(function(){layer_1.triggerRepaint()}),pointFolder.add(layer_1,"strokeWidth",1,10,.1).onChange(function(){layer_1.triggerRepaint()}),pointFolder.add(layer_1,"strokeOpacity",0,1,.1).onChange(function(){layer_1.triggerRepaint()}),(layers=map.getStyle().layers)&&layers.length){for(labelLayerId=void 0,i=0;i<layers.length;i++)if(layers[i]&&"symbol"===layers[i].type&&layers[i].layout["text-field"]){labelLayerId=layers[i].id;break}map.addLayer(layer_1,labelLayerId)}_c.label=3;case 3:return[2]}})})}}))},CircleLayerDemo}(React.Component);exports.default=CircleLayerDemo},670:function(module,exports,__webpack_require__){"use strict";(function(module){Object.defineProperty(exports,"__esModule",{value:!0});var React=__webpack_require__(1),react_1=__webpack_require__(81),Text_md_1=__webpack_require__(671),TextForPolygon_md_1=__webpack_require__(672),TextForPoint_1=__webpack_require__(673),TextForPolygon_1=__webpack_require__(674);react_1.storiesOf("TextLayer",module).add("Point Feature",function(){return React.createElement(TextForPoint_1.default,null)},{notes:{markdown:Text_md_1.default}}).add("Polygon Feature",function(){return React.createElement(TextForPolygon_1.default,null)},{notes:{markdown:TextForPolygon_md_1.default}})}).call(this,__webpack_require__(30)(module))},671:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_exports__.default="文本避让参考 Mapbox 实现，采用基于网格的碰撞检测策略。"},672:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_exports__.default="为 Polygon 要素自动添加文本标注。\n在 Worker 中计算多边形难抵极作为文本锚点。"},673:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}};Object.defineProperty(exports,"__esModule",{value:!0});var React=__webpack_require__(1),react_mapbox_gl_1=__webpack_require__(51),dat=__webpack_require__(49),src_1=__webpack_require__(50),Map=react_mapbox_gl_1.default({accessToken:"pk.eyJ1IjoieGlhb2l2ZXIiLCJhIjoiY2pxcmc5OGNkMDY3cjQzbG42cXk5NTl3YiJ9.hUC5Chlqzzh0FFd_aEc-uQ"}),VectorLineLayer=function(_super){function VectorLineLayer(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(VectorLineLayer,_super),VectorLineLayer.prototype.componentWillUnmount=function(){this.gui&&this.gui.destroy(),this.$stats&&document.body.removeChild(this.$stats)},VectorLineLayer.prototype.render=function(){var _this=this;return React.createElement(React.Fragment,null,React.createElement("div",{id:"stats"}),React.createElement(Map,{style:"mapbox://styles/mapbox/light-v9",center:[-95.96471106679122,28.604925848431535],zoom:[0],containerStyle:{height:"100vh",width:"100vw"},onStyleLoad:function(map){return __awaiter(_this,void 0,void 0,function(){var geoJSON,layer_1,circleLayer,gui,textFolder,layoutFolder,layers,labelLayerId,i;return __generator(this,function(_a){switch(_a.label){case 0:return map?[4,fetch("https://d2ad6b4ur7yvpq.cloudfront.net/naturalearth-3.3.0/ne_10m_geography_regions_points.geojson")]:[3,3];case 1:return[4,_a.sent().json()];case 2:if(geoJSON=_a.sent(),layer_1=new src_1.TextLayer({url:"https://d2ad6b4ur7yvpq.cloudfront.net/naturalearth-3.3.0/ne_10m_geography_regions_points.geojson"}),(circleLayer=new src_1.CircleLayer({geoJSON:geoJSON})).pointRadius=4,gui=new dat.GUI,this.gui=gui,gui.add(layer_1,"debug").onChange(function(){layer_1.triggerRepaint()}),(textFolder=gui.addFolder("font")).add(layer_1,"fontFamily",["Monaco, monospace","sans-serif"]).onChange(function(){layer_1.initGlyphAtlas(),layer_1.triggerRepaint()}),textFolder.add(layer_1,"fontWeight",400,1e3).onChange(function(){layer_1.initGlyphAtlas(),layer_1.triggerRepaint()}),textFolder.add(layer_1,"fontSize",8,128).onChange(function(){layer_1.triggerRepaint()}),textFolder.addColor(layer_1,"fontColor").onChange(function(){layer_1.triggerRepaint()}),textFolder.add(layer_1,"fontOpacity",0,1,.1).onChange(function(){layer_1.triggerRepaint()}),textFolder.addColor(layer_1,"haloColor").onChange(function(){layer_1.triggerRepaint()}),textFolder.add(layer_1,"haloWidth",0,24,.1).onChange(function(){layer_1.triggerRepaint()}),textFolder.add(layer_1,"haloBlur",0,2,.1).onChange(function(){layer_1.triggerRepaint()}),(layoutFolder=gui.addFolder("label layout")).add(layer_1,"symbolAnchor",["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]).onChange(function(){layer_1.triggerRepaint()}),layoutFolder.add(layer_1,"textSpacing",0,10,.1).onChange(function(){layer_1.triggerRepaint()}),layoutFolder.add(layer_1,"textOffsetX",-20,20,.1).onChange(function(){layer_1.triggerRepaint()}),layoutFolder.add(layer_1,"textOffsetY",-20,20,.1).onChange(function(){layer_1.triggerRepaint()}),(layers=map.getStyle().layers)&&layers.length){for(labelLayerId=void 0,i=0;i<layers.length;i++)if(layers[i]&&"symbol"===layers[i].type&&layers[i].layout["text-field"]){labelLayerId=layers[i].id;break}map.addLayer(circleLayer,labelLayerId),map.addLayer(layer_1,labelLayerId)}_a.label=3;case 3:return[2]}})})}}))},VectorLineLayer}(React.Component);exports.default=VectorLineLayer},674:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}};Object.defineProperty(exports,"__esModule",{value:!0});var React=__webpack_require__(1),react_mapbox_gl_1=__webpack_require__(51),dat=__webpack_require__(49),src_1=__webpack_require__(50),Map=react_mapbox_gl_1.default({accessToken:"pk.eyJ1IjoieGlhb2l2ZXIiLCJhIjoiY2pxcmc5OGNkMDY3cjQzbG42cXk5NTl3YiJ9.hUC5Chlqzzh0FFd_aEc-uQ"}),VectorLineLayer=function(_super){function VectorLineLayer(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(VectorLineLayer,_super),VectorLineLayer.prototype.componentWillUnmount=function(){this.gui&&this.gui.destroy(),this.$stats&&document.body.removeChild(this.$stats)},VectorLineLayer.prototype.render=function(){var _this=this;return React.createElement(React.Fragment,null,React.createElement("div",{id:"stats"}),React.createElement(Map,{style:"mapbox://styles/mapbox/light-v9",center:[-95.96471106679122,28.604925848431535],zoom:[0],containerStyle:{height:"100vh",width:"100vw"},onStyleLoad:function(map){return __awaiter(_this,void 0,void 0,function(){var layer_1,gui,textFolder,layoutFolder,layers,i;return __generator(this,function(_a){if(map&&(map.addSource("test source",{type:"geojson",data:"https://d2ad6b4ur7yvpq.cloudfront.net/naturalearth-3.3.0/ne_50m_geography_marine_polys.geojson"}),layer_1=new src_1.TextLayer({url:"https://d2ad6b4ur7yvpq.cloudfront.net/naturalearth-3.3.0/ne_50m_geography_marine_polys.geojson",haloWidth:2}),gui=new dat.GUI,this.gui=gui,gui.add(layer_1,"debug").onChange(function(){layer_1.triggerRepaint()}),(textFolder=gui.addFolder("font")).add(layer_1,"fontFamily",["Monaco, monospace","sans-serif"]).onChange(function(){layer_1.initGlyphAtlas(),layer_1.triggerRepaint()}),textFolder.add(layer_1,"fontWeight",400,1e3).onChange(function(){layer_1.initGlyphAtlas(),layer_1.triggerRepaint()}),textFolder.add(layer_1,"fontSize",8,128).onChange(function(){layer_1.triggerRepaint()}),textFolder.addColor(layer_1,"fontColor").onChange(function(){layer_1.triggerRepaint()}),textFolder.add(layer_1,"fontOpacity",0,1,.1).onChange(function(){layer_1.triggerRepaint()}),textFolder.addColor(layer_1,"haloColor").onChange(function(){layer_1.triggerRepaint()}),textFolder.add(layer_1,"haloWidth",0,24,.1).onChange(function(){layer_1.triggerRepaint()}),textFolder.add(layer_1,"haloBlur",0,2,.1).onChange(function(){layer_1.triggerRepaint()}),(layoutFolder=gui.addFolder("label layout")).add(layer_1,"symbolAnchor",["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]).onChange(function(){layer_1.triggerRepaint()}),layoutFolder.add(layer_1,"textSpacing",0,10,.1).onChange(function(){layer_1.triggerRepaint()}),layoutFolder.add(layer_1,"textOffsetX",-20,20,.1).onChange(function(){layer_1.triggerRepaint()}),layoutFolder.add(layer_1,"textOffsetY",-20,20,.1).onChange(function(){layer_1.triggerRepaint()}),(layers=map.getStyle().layers)&&layers.length)){for(void 0,i=0;i<layers.length;i++)if(layers[i]&&"symbol"===layers[i].type&&layers[i].layout["text-field"]){layers[i].id;break}map.addLayer({id:"maine",type:"fill",source:"test source",paint:{"fill-color":["interpolate",["linear"],["get","scalerank"],0,["to-color","#abb7ef"],10,["to-color","#3a57e0"]],"fill-opacity":1}}),map.addLayer(layer_1)}return[2]})})}}))},VectorLineLayer}(React.Component);exports.default=VectorLineLayer},675:function(module,exports,__webpack_require__){"use strict";(function(module){Object.defineProperty(exports,"__esModule",{value:!0});var React=__webpack_require__(1),react_1=__webpack_require__(81),VectorTileCluster_md_1=__webpack_require__(676),VectorTileLine_md_1=__webpack_require__(677),VectorTileLine_1=__webpack_require__(678),VectorTileCluster_1=__webpack_require__(679);react_1.storiesOf("VectorLayer",module).add("Line",function(){return React.createElement(VectorTileLine_1.default,null)},{notes:{markdown:VectorTileLine_md_1.default}}).add("Cluster",function(){return React.createElement(VectorTileCluster_1.default,null)},{notes:{markdown:VectorTileCluster_md_1.default}})}).call(this,__webpack_require__(30)(module))},676:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_exports__.default='Cluster 实现详见：[使用 k-d tree 实现点聚合图](https://zhuanlan.zhihu.com/p/64450167)\n\n另外包含以下特性：\n\n* SDF 渲染文字，详见 [在 WebGL 中渲染文字](https://zhuanlan.zhihu.com/p/65421383)。勾选 "debug" 选项可以看到左下角生成的 SDF Atlas。\n* 基于 SDF 实现 halo 描边，可配置宽度、颜色和模糊半径。\n* 文本标注，可配置布局。\n* SDF 渲染点的形状，包括圆形、星形、三角形、正六边形等。\n* [WebGL 中的顶点数据压缩](https://zhuanlan.zhihu.com/p/67484498)\n\n全部配置项如下，参考 Mapbox 样式标准：\n\n* 叶节点（多种形状）\n    * pointColor 点颜色\n    * pointRadius 点半径\n    * pointOpacity 透明度\n    * strokeColor 描边颜色\n    * strokeWidth 描边宽度\n    * strokeOpacity 描边透明度\n* 文字样式\n    * fontSize 字号\n    * fontColor 字体颜色\n    * fontOpacity 字体透明度\n    * haloColor 外描边颜色\n    * haloWidth 外描边宽度\n    * haloBlur 外描边模糊半径\n* 文本布局\n    * symbolAnchor 锚点位置\n    * textSpacing 字符间距\n    * textOffset 偏移量'},677:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_exports__.default="[使用数据瓦片展示海量数据](https://zhuanlan.zhihu.com/p/64130041)"},678:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}};Object.defineProperty(exports,"__esModule",{value:!0});var React=__webpack_require__(1),react_mapbox_gl_1=__webpack_require__(51),dat=__webpack_require__(49),src_1=__webpack_require__(50),Map=react_mapbox_gl_1.default({accessToken:"pk.eyJ1IjoieGlhb2l2ZXIiLCJhIjoiY2pxcmc5OGNkMDY3cjQzbG42cXk5NTl3YiJ9.hUC5Chlqzzh0FFd_aEc-uQ"}),VectorLineLayer=function(_super){function VectorLineLayer(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(VectorLineLayer,_super),VectorLineLayer.prototype.componentWillUnmount=function(){this.gui&&this.gui.destroy()},VectorLineLayer.prototype.render=function(){var _this=this;return React.createElement(Map,{style:"mapbox://styles/mapbox/light-v9",center:[102.602992,23.107329],zoom:[15],containerStyle:{height:"100vh",width:"100vw"},onStyleLoad:function(map){return __awaiter(_this,void 0,void 0,function(){var response,layer_1,_a,_b,gui,layers,labelLayerId,i;return __generator(this,function(_c){switch(_c.label){case 0:return map?[4,fetch("https://gw.alipayobjects.com/os/rmsportal/ZVfOvhVCzwBkISNsuKCc.json")]:[3,3];case 1:return response=_c.sent(),_a=src_1.VectorTileLineLayer.bind,_b={lineThickness:6.8},[4,response.json()];case 2:if(layer_1=new(_a.apply(src_1.VectorTileLineLayer,[void 0,(_b.geoJSON=_c.sent(),_b)])),gui=new dat.GUI,this.gui=gui,gui.addFolder("line").add(layer_1,"lineThickness",1,10).onChange(function(){layer_1.triggerRepaint()}),(layers=map.getStyle().layers)&&layers.length){for(labelLayerId=void 0,i=0;i<layers.length;i++)if(layers[i]&&"symbol"===layers[i].type&&layers[i].layout["text-field"]){labelLayerId=layers[i].id;break}map.addLayer(layer_1,labelLayerId)}_c.label=3;case 3:return[2]}})})}})},VectorLineLayer}(React.Component);exports.default=VectorLineLayer},679:function(module,exports,__webpack_require__){"use strict";var extendStatics,__extends=this&&this.__extends||(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)},function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=this&&this.__generator||function(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=(t=_.trys).length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}};Object.defineProperty(exports,"__esModule",{value:!0});var React=__webpack_require__(1),react_mapbox_gl_1=__webpack_require__(51),dat=__webpack_require__(49),src_1=__webpack_require__(50),Map=react_mapbox_gl_1.default({accessToken:"pk.eyJ1IjoieGlhb2l2ZXIiLCJhIjoiY2pxcmc5OGNkMDY3cjQzbG42cXk5NTl3YiJ9.hUC5Chlqzzh0FFd_aEc-uQ"}),VectorLineLayer=function(_super){function VectorLineLayer(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(VectorLineLayer,_super),VectorLineLayer.prototype.componentWillUnmount=function(){this.gui&&this.gui.destroy(),this.$stats&&document.body.removeChild(this.$stats)},VectorLineLayer.prototype.render=function(){var _this=this;return React.createElement(React.Fragment,null,React.createElement("div",{id:"stats"}),React.createElement(Map,{style:"mapbox://styles/mapbox/light-v9",center:[-95.96471106679122,28.604925848431535],zoom:[0],containerStyle:{height:"100vh",width:"100vw"},onStyleLoad:function(map){return __awaiter(_this,void 0,void 0,function(){var response,layer_1,_a,_b,gui,pointFolder,textFolder,layoutFolder,layers,labelLayerId,i;return __generator(this,function(_c){switch(_c.label){case 0:return map?[4,fetch("https://d2ad6b4ur7yvpq.cloudfront.net/naturalearth-3.3.0/ne_10m_geography_regions_points.geojson")]:[3,3];case 1:return response=_c.sent(),_a=src_1.VectorTileClusterLayer.bind,_b={},[4,response.json()];case 2:if(layer_1=new(_a.apply(src_1.VectorTileClusterLayer,[void 0,(_b.geoJSON=_c.sent().features,_b)])),gui=new dat.GUI,this.gui=gui,gui.add(layer_1,"debug").onChange(function(){layer_1.triggerRepaint()}),(pointFolder=gui.addFolder("leaf point")).addColor(layer_1,"pointColor").onChange(function(){layer_1.triggerRepaint()}),pointFolder.add(layer_1,"pointRadius",2,20).onChange(function(){layer_1.triggerRepaint()}),pointFolder.add(layer_1,"pointOpacity",0,1,.1).onChange(function(){layer_1.triggerRepaint()}),pointFolder.addColor(layer_1,"strokeColor").onChange(function(){layer_1.triggerRepaint()}),pointFolder.add(layer_1,"strokeWidth",1,10,.1).onChange(function(){layer_1.triggerRepaint()}),pointFolder.add(layer_1,"strokeOpacity",0,1,.1).onChange(function(){layer_1.triggerRepaint()}),(textFolder=gui.addFolder("font in cluster")).add(layer_1,"fontSize",8,128).onChange(function(){layer_1.triggerRepaint()}),textFolder.addColor(layer_1,"fontColor").onChange(function(){layer_1.triggerRepaint()}),textFolder.add(layer_1,"fontOpacity",0,1,.1).onChange(function(){layer_1.triggerRepaint()}),textFolder.addColor(layer_1,"haloColor").onChange(function(){layer_1.triggerRepaint()}),textFolder.add(layer_1,"haloWidth",0,24,.1).onChange(function(){layer_1.triggerRepaint()}),textFolder.add(layer_1,"haloBlur",0,2,.1).onChange(function(){layer_1.triggerRepaint()}),(layoutFolder=gui.addFolder("label layout")).add(layer_1,"symbolAnchor",["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]).onChange(function(){layer_1.triggerRepaint()}),layoutFolder.add(layer_1,"textSpacing",0,10,.1).onChange(function(){layer_1.triggerRepaint()}),layoutFolder.add(layer_1,"textOffsetX",-20,20,.1).onChange(function(){layer_1.triggerRepaint()}),layoutFolder.add(layer_1,"textOffsetY",-20,20,.1).onChange(function(){layer_1.triggerRepaint()}),(layers=map.getStyle().layers)&&layers.length){for(labelLayerId=void 0,i=0;i<layers.length;i++)if(layers[i]&&"symbol"===layers[i].type&&layers[i].layout["text-field"]){labelLayerId=layers[i].id;break}map.addLayer(layer_1,labelLayerId)}_c.label=3;case 3:return[2]}})})}}))},VectorLineLayer}(React.Component);exports.default=VectorLineLayer},68:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var Point=__webpack_require__(116),mercator_coordinate_1=__webpack_require__(117),assert=__webpack_require__(595);exports.EXTENT=8192;var CanonicalTileID=function(){function CanonicalTileID(z,x,y){assert(z>=0&&z<=25),assert(x>=0&&x<Math.pow(2,z)),assert(y>=0&&y<Math.pow(2,z)),this.z=z,this.x=x,this.y=y,this.key=calculateKey(0,z,x,y)}return CanonicalTileID.prototype.equals=function(id){return this.z===id.z&&this.x===id.x&&this.y===id.y},CanonicalTileID.prototype.getTilePoint=function(coord){var tilesAtZoom=Math.pow(2,this.z);return new Point((coord.x*tilesAtZoom-this.x)*exports.EXTENT,(coord.y*tilesAtZoom-this.y)*exports.EXTENT)},CanonicalTileID}();exports.CanonicalTileID=CanonicalTileID;var UnwrappedTileID=function(){return function UnwrappedTileID(wrap,canonical){this.wrap=wrap,this.canonical=canonical,this.key=calculateKey(wrap,canonical.z,canonical.x,canonical.y)}}();exports.UnwrappedTileID=UnwrappedTileID;var OverscaledTileID=function(){function OverscaledTileID(overscaledZ,wrap,z,x,y){assert(overscaledZ>=z),this.overscaledZ=overscaledZ,this.wrap=wrap,this.canonical=new CanonicalTileID(z,+x,+y),this.key=calculateKey(wrap,overscaledZ,x,y)}return OverscaledTileID.prototype.equals=function(id){return this.overscaledZ===id.overscaledZ&&this.wrap===id.wrap&&this.canonical.equals(id.canonical)},OverscaledTileID.prototype.scaledTo=function(targetZ){assert(targetZ<=this.overscaledZ);var zDifference=this.canonical.z-targetZ;return targetZ>this.canonical.z?new OverscaledTileID(targetZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new OverscaledTileID(targetZ,this.wrap,targetZ,this.canonical.x>>zDifference,this.canonical.y>>zDifference)},OverscaledTileID.prototype.isChildOf=function(parent){if(parent.wrap!==this.wrap)return!1;var zDifference=this.canonical.z-parent.canonical.z;return 0===parent.overscaledZ||parent.overscaledZ<this.overscaledZ&&parent.canonical.x===this.canonical.x>>zDifference&&parent.canonical.y===this.canonical.y>>zDifference},OverscaledTileID.prototype.children=function(sourceMaxZoom){if(this.overscaledZ>=sourceMaxZoom)return[new OverscaledTileID(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var z=this.canonical.z+1,x=2*this.canonical.x,y=2*this.canonical.y;return[new OverscaledTileID(z,this.wrap,z,x,y),new OverscaledTileID(z,this.wrap,z,x+1,y),new OverscaledTileID(z,this.wrap,z,x,y+1),new OverscaledTileID(z,this.wrap,z,x+1,y+1)]},OverscaledTileID.prototype.isLessThan=function(rhs){return this.wrap<rhs.wrap||!(this.wrap>rhs.wrap)&&(this.overscaledZ<rhs.overscaledZ||!(this.overscaledZ>rhs.overscaledZ)&&(this.canonical.x<rhs.canonical.x||!(this.canonical.x>rhs.canonical.x)&&this.canonical.y<rhs.canonical.y))},OverscaledTileID.prototype.wrapped=function(){return new OverscaledTileID(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},OverscaledTileID.prototype.unwrapTo=function(wrap){return new OverscaledTileID(this.overscaledZ,wrap,this.canonical.z,this.canonical.x,this.canonical.y)},OverscaledTileID.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},OverscaledTileID.prototype.toUnwrapped=function(){return new UnwrappedTileID(this.wrap,this.canonical)},OverscaledTileID.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},OverscaledTileID.prototype.getTilePoint=function(coord){return this.canonical.getTilePoint(new mercator_coordinate_1.default(coord.x-this.wrap,coord.y))},OverscaledTileID}();function calculateKey(wrap,z,x,y){(wrap*=2)<0&&(wrap=-1*wrap-1);var dim=1<<z;return 32*(dim*dim*wrap+dim*y+x)+z}exports.OverscaledTileID=OverscaledTileID}},[[281,1,2]]]);
//# sourceMappingURL=main.be14b4a28feacbf73fa4.bundle.js.map